<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="NordSym bygger intelligenta system som bygger sig sj√§lva. Fr√•n enskilda agenter till skr√§ddarsydda ekosystem f√∂r er framg√•ng.">
    <meta name="keywords" content="Systemautomation Sverige, intelligenta system, processautomation, skr√§ddarsydda system, digital transformation, NordSym">
    <meta name="author" content="NordSym AB">
    <link rel="canonical" href="https://nordsym.com">
    <title>NordSym AB - System som v√§xer med framtiden</title>
    
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="NordSym AB">
    <meta property="og:locale" content="sv_SE">
    <meta property="og:title" content="NordSym AB - System som v√§xer med framtiden">
    <meta property="og:description" content="Vi bygger system som bygger sig sj√§lva. Fr√•n kaos till klarhet.">
    <meta property="og:image" content="https://raw.githubusercontent.com/GusHem/Logga-utan-text/refs/heads/main/Final%20logo%20no%20text.svg">
    <meta property="og:url" content="https://nordsym.com">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@NordSym">
    <meta name="twitter:creator" content="@NordSym">
    <meta name="twitter:title" content="NordSym AB - System som v√§xer med framtiden">
    
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="X-Frame-Options" content="DENY">
    <meta http-equiv="Referrer-Policy" content="strict-origin-when-cross-origin">

    <script async src="https://www.googletagmanager.com/gtag/js?id=G-KRLNF7DHVJ"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-KRLNF7DHVJ', { page_title: document.title, page_location: window.location.href });
    </script>
    
    <script type="text/javascript">
        (function(c,l,a,r,i,t,y){
            c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
            t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
            y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
        })(window, document, "clarity", "script", "s6ismr0411");
    </script>

    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    
    <!-- Dependencies -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <!-- Post-processing for Glow Effect (Optional Enhancement) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/examples/js/postprocessing/EffectComposer.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/examples/js/postprocessing/RenderPass.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/examples/js/postprocessing/UnrealBloomPass.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/examples/js/shaders/LuminosityHighPassShader.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/examples/js/shaders/CopyShader.js"></script>


    <link rel="preconnect" href="https://www.google-analytics.com">
    <link rel="dns-prefetch" href="//fonts.gstatic.com">
    <link rel="dns-prefetch" href="//formspree.io">
    <link rel="preload" href="https://raw.githubusercontent.com/GusHem/Logga-utan-text/refs/heads/main/Final%20logo%20no%20text.svg" as="image">
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Comfortaa:wght@700&display=swap" as="style">
    <link rel="preload" href="https://unpkg.com/@phosphor-icons/web" as="script">

    <link href="https://fonts.googleapis.com/css2?family=Comfortaa:wght@700&family=Inter:wght@300;400;500;600;700;800&family=Source+Code+Pro:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <link rel="icon" href="https://raw.githubusercontent.com/GusHem/Logga-utan-text/refs/heads/main/Final%20logo%20no%20text.svg">
    <style>
        html, body {
            height: 100%; margin: 0; padding: 0;
            /* Harmoni-fix: Utrotar scroll-konflikten genom att ta bort den globala 'scroll-behavior',
               vilket ger GSAP och JS full, oinskr√§nkt kontroll √∂ver alla animationer. */
        }
        body {
            font-family: 'Inter', sans-serif; color: #E2E8F0; 
            padding-top: 80px; display: flex; flex-direction: column;
            background-color: #0c1427;
            min-height: 100vh;
            overflow-y: auto; /* Harmoni-fix: S√§kerst√§ller vertikal scrollning p√• alla enheter. */
        }
        body.labb-active { 
            overflow: hidden;
        }
        @media (min-width: 1024px) { 
            body { padding-top: 116px; } 
        }
        main { flex-grow: 1; background: transparent; }
        :root {
            --nord-sym-cyan: #00D4FF;
            --nord-sym-orange: #FF8C00;
            --nord-sym-purple: #9370DB;
            --nord-sym-deep-space-blue: #0c1427; 
            --nord-sym-mid-space-blue: #1e3a8a; 
            --nord-sym-light-accent: #7dd3fc; 
            --nord-sym-text-light: #F0F4F8; 
            --nord-sym-text-medium: #CBD5E0; 
            --nord-sym-cyan-rgb: 0, 212, 255;
            --nord-sym-light-accent-rgb: 125, 211, 252;
        }
        .nord-accent-text { color: var(--nord-sym-cyan); }
        h1, h2, .section-title { font-family: 'Comfortaa', sans-serif; }
        .page-content-padding { padding-top: 4rem; padding-bottom: 4rem; }
        .space-background-section {
            background: transparent !important;
            position: relative; overflow: hidden; width: 100%; 
            display: flex; flex-direction: column; align-items: center;
        }
        #hero {
             min-height: calc(100vh - 80px); min-height: -webkit-fill-available;
             justify-content: center; padding-top: 4rem; padding-bottom: 4rem;
             position: relative; /* For canvas positioning */
        }
        @media (min-width: 1024px) { #hero { min-height: calc(100vh - 116px); } }
        #karriar .section-content-wrapper { max-width: 800px; }
        #karriar .intro-text, #karriar .detail-text { font-size: 1.125rem; line-height: 1.7; }
        @media (min-width: 1024px) {
            #karriar .section-title { font-size: 3.75rem; }
            #karriar .intro-text, #karriar .detail-text { font-size: 1.25rem; }
        }
        .section-content-wrapper { 
            position: relative; z-index: 1; width: 100%; max-width: 1280px; 
            padding-left: 1.5rem; padding-right: 1.5rem; margin-left: auto; margin-right: auto;
        }
        .nav-link.active { color: var(--nord-sym-cyan); font-weight: 700; } 
        .btn-base {
            font-weight: 600; border-radius: 9999px; transition: all 0.3s ease;
            box-shadow: 0px 6px 12px rgba(0, 0, 0, 0.25), 0px 2px 4px rgba(0,0,0,0.2), 
                        inset 0px -2px 1px rgba(255,255,255,0.05), inset 0px 1px 1px rgba(0,0,0,0.1); 
            display: inline-flex; align-items: center; justify-content: center;
            gap: 0.5rem; text-align: center;
        }
        .btn-cta-revised {
            padding: 0.85rem 2.25rem;
            background: rgba(0, 31, 63, 0.8);
            border: 2px solid var(--nord-sym-cyan);
            color: var(--nord-sym-cyan);
            backdrop-filter: blur(8px); -webkit-backdrop-filter: blur(8px);
            font-weight: 600;
        }
        .btn-cta-revised:hover {
            background: rgba(var(--nord-sym-cyan-rgb), 0.1);
            box-shadow: 0 0 25px rgba(var(--nord-sym-cyan-rgb), 0.5);
            transform: translateY(-3px) scale(1.03);
        }
        .btn-secondary-on-dark {
            padding: 0.85rem 2.25rem; color: var(--nord-sym-text-light);
            border: 2px solid var(--nord-sym-text-light);
        }
        .btn-secondary-on-dark:hover {
            background-color: var(--nord-sym-text-light); color: var(--nord-sym-deep-space-blue);
            transform: translateY(-3px) scale(1.03);
             box-shadow: 0px 10px 20px rgba(240, 244, 248, 0.25), 0px 5px 10px rgba(0,0,0,0.2),
                        inset 0px -2px 2px rgba(255,255,255,0.03);
        }
        .btn-service-cta { 
            padding: 0.6rem 1.5rem; font-size: 0.875rem; background-color: transparent;
            color: var(--nord-sym-cyan); border: 2px solid var(--nord-sym-cyan);
        }
        .btn-service-cta:hover {
            background-color: var(--nord-sym-cyan); color: var(--nord-sym-deep-space-blue);
            transform: translateY(-2px) scale(1.02);
            box-shadow: 0px 8px 18px rgba(var(--nord-sym-cyan-rgb), 0.35), 0px 4px 7px rgba(0,0,0,0.2),
                        inset 0px -1px 2px rgba(255,255,255,0.08);
        }
        
        /* --- VENNDIAGRAM-HARMONISERING --- */
        .venn-diagram-container {
            display: flex; justify-content: center; align-items: center;
            min-height: 350px;
        }
        .venn-diagram-wrapper {
            position: relative; width: 440px; height: 280px;
            transition: all 0.3s ease-in-out;
        }
        .venn-circle {
            position: absolute;
            width: 280px; height: 280px;
            border-radius: 50%;
            background: radial-gradient(circle at 50% 50%, rgba(var(--nord-sym-cyan-rgb), 0.05) 0%, rgba(var(--nord-sym-cyan-rgb), 0.15) 100%);
            border: 1px solid rgba(var(--nord-sym-cyan-rgb), 0.3);
            display: flex; 
            align-items: center;
            box-shadow: inset 0 0 20px rgba(var(--nord-sym-cyan-rgb), 0.1), 0 0 15px rgba(var(--nord-sym-deep-space-blue), 0.5);
            animation: venn-pulse 8s infinite ease-in-out;
            transition: all 0.3s ease-in-out;
        }
        .venn-circle-1 { top: 0; left: 0; animation-delay: 0s; justify-content: flex-start; }
        .venn-circle-2 { top: 0; right: 0; animation-delay: -4s; justify-content: flex-end; }
        .venn-circle-text {
            font-family: 'Comfortaa', sans-serif;
            font-weight: 700;
            color: var(--nord-sym-text-light);
            text-align: center;
            font-size: 1.1rem;
            max-width: 140px;
            padding: 0 2.5rem;
        }
        .venn-overlap-text {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            font-family: 'Comfortaa', sans-serif;
            font-weight: 700;
            font-size: 1.5rem;
            color: var(--nord-sym-light-accent);
            cursor: pointer;
            transition: all 0.3s ease;
            text-shadow: 0 0 10px rgba(var(--nord-sym-light-accent-rgb), 0.3);
        }
        .venn-overlap-text:hover {
            color: var(--nord-sym-cyan);
            filter: drop-shadow(0 0 15px rgba(var(--nord-sym-cyan-rgb), 0.8));
            transform: translate(-50%, -50%) scale(1.05);
        }
        @keyframes venn-pulse {
            50% { transform: scale(1.02); border-color: rgba(var(--nord-sym-cyan-rgb), 0.5); }
        }
        
        /* Harmoni-fix: Responsiv typografi f√∂r Venn-diagrammet */
        @media (max-width: 768px) {
            .venn-diagram-wrapper { width: 320px; height: 200px; }
            .venn-circle { width: 200px; height: 200px; }
            .venn-circle-text { font-size: 0.9rem; max-width: 100px; }
            .venn-overlap-text { font-size: 1rem; width: 100px; }
        }
        @media (max-width: 480px) {
            .venn-diagram-wrapper { width: 260px; height: 160px; }
            .venn-circle { width: 160px; height: 160px; }
            .venn-circle-text { font-size: 0.75rem; max-width: 70px; }
            .venn-overlap-text { font-size: 0.9rem; width: 90px; }
        }

        /* --- GALLERY HARMONIZATION --- */
        .gallery-container {
            position: relative;
        }
        .gallery-viewport {
            overflow: hidden;
        }
        .gallery-wrapper {
            display: flex;
            gap: 2rem;
            transition: transform 0.6s cubic-bezier(0.22, 1, 0.36, 1);
        }
        .archetype-card {
            background-color: rgba(var(--nord-sym-deep-space-blue), 0.7);
            border: 1px solid rgba(var(--nord-sym-cyan-rgb), 0.3);
            backdrop-filter: blur(8px);
            border-radius: 1.5rem;
            padding: 2.5rem 2rem;
            display: flex;
            flex-direction: column;
            text-align: center;
            align-items: center;
            min-height: 420px; /* Ensure consistent height */
            flex-shrink: 0; /* F√∂rhindra att korten krymper */
            width: calc(100% / 3 - (4rem / 3)); /* 3 kort med 2rem gap */
        }
        @media (max-width: 1024px) {
            .archetype-card { width: calc(50% - 1rem); }
        }
        @media (max-width: 768px) {
            .gallery-wrapper { 
                scroll-snap-type: x mandatory; 
                overflow-x: auto; 
                gap: 1rem;
            }
            .archetype-card { 
                scroll-snap-align: start; 
                width: 90%; 
            }
        }
         .archetype-card:hover {
            box-shadow: 0 0 25px rgba(var(--nord-sym-cyan-rgb), 0.4), 0 4px 15px rgba(0,0,0,0.3);
            border-color: var(--nord-sym-cyan);
            transform: translateY(-5px);
        }
        .archetype-card > i { /* Direct child selector for main icon */
            font-size: 2.75rem;
            color: var(--nord-sym-cyan);
            margin-bottom: 1.25rem;
            transition: transform 0.3s ease, filter 0.3s ease;
        }
        .archetype-card:hover > i {
            transform: scale(1.1);
            filter: drop-shadow(0 0 10px rgba(var(--nord-sym-cyan-rgb), 0.7));
        }
        .archetype-card h4 {
            font-family: 'Comfortaa', sans-serif;
            color: var(--nord-sym-light-accent);
            font-size: 1.25rem;
            margin-bottom: 0.75rem;
        }
        .archetype-card .description {
            color: var(--nord-sym-text-medium);
            line-height: 1.6;
            font-size: 0.9rem;
            flex-grow: 1;
            margin-bottom: 1.25rem;
        }
        .tech-signature-container {
            display: flex;
            justify-content: center;
            gap: 1.5rem;
            margin-bottom: 1.5rem;
            width: 100%;
        }
        .tech-signature-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.25rem;
        }
        .tech-signature-item i {
            font-size: 1.5rem;
            color: var(--nord-sym-text-medium);
        }
        .tech-signature-item span {
            font-size: 0.75rem;
            color: var(--nord-sym-text-medium);
            font-weight: 500;
        }
        .archetype-cta {
            margin-bottom: 1.5rem;
            padding: 0.5rem 1.25rem;
            font-size: 0.875rem;
            background: transparent;
            border: 1px solid var(--nord-sym-text-medium);
            color: var(--nord-sym-text-medium);
            box-shadow: none;
        }
        .archetype-cta:hover {
            background: rgba(var(--nord-sym-cyan-rgb), 0.1);
            border-color: var(--nord-sym-cyan);
            color: var(--nord-sym-cyan);
            transform: translateY(-2px);
            box-shadow: 0 0 15px rgba(var(--nord-sym-cyan-rgb), 0.3);
        }
        .archetype-card .indicator {
            font-size: 0.8rem;
            color: var(--nord-sym-text-medium);
            border-top: 1px solid rgba(var(--nord-sym-cyan-rgb), 0.2);
            padding-top: 1rem;
            width: 100%;
            margin-top: auto;
            font-style: italic;
        }
        .archetype-card.teaser {
            position: relative;
            overflow: hidden;
            cursor: not-allowed;
            pointer-events: none;
        }
        .archetype-card.teaser > * {
            filter: blur(4px);
            opacity: 0.5;
        }
        .archetype-card.teaser::after {
            content: 'UNDER UTVECKLING';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(-15deg);
            font-size: 2.5rem;
            font-weight: 700;
            font-family: 'Comfortaa', sans-serif;
            color: rgba(var(--nord-sym-light-accent-rgb), 0.15);
            z-index: 1;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            text-shadow: 0 0 10px rgba(0,0,0,0.5);
        }
        /* --- SYSTEM/PRICING CARD HARMONIZATION --- */
        .pricing-card {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(var(--nord-sym-cyan-rgb), 0.15);
            padding: 2.5rem 2rem;
            text-align: left;
            display: flex;
            flex-direction: column;
            border-radius: 1.5rem;
            height: 100%;
        }
        .pricing-card-header {
            margin-bottom: 1.5rem;
        }
        .pricing-card-header h3 {
             font-family: 'Comfortaa', sans-serif;
            color: var(--nord-sym-light-accent);
            font-size: 1.25rem;
            margin-bottom: 0.5rem;
        }
        .price-display {
            font-family: 'Comfortaa', sans-serif;
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 2rem;
        }
        .price-period {
            font-size: 1rem;
            color: var(--nord-sym-text-medium);
            font-weight: 400;
        }
        .venn-overlap-text {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            font-family: 'Comfortaa', sans-serif;
            font-weight: 700;
            font-size: 1.25rem;
            color: var(--nord-sym-light-accent);
            cursor: pointer;
            transition: all 0.3s ease;
            text-shadow: 0 0 10px rgba(var(--nord-sym-light-accent-rgb), 0.3);
            width: 120px;
            text-align: center;
        }
        .venn-overlap-text:hover {
            color: var(--nord-sym-cyan);
            filter: drop-shadow(0 0 20px rgba(var(--nord-sym-cyan-rgb), 0.9));
        }
        @keyframes venn-pulse {
            50% { transform: scale(1.02); border-color: rgba(var(--nord-sym-cyan-rgb), 0.5); }
        }
        
        .gallery-nav {
            position: absolute; top: 50%; transform: translateY(-50%); z-index: 10;
            background-color: rgba(var(--nord-sym-deep-space-blue), 0.5); backdrop-filter: blur(5px);
            border: 1px solid rgba(var(--nord-sym-cyan-rgb), 0.3); border-radius: 50%;
            width: 44px; height: 44px; display: flex; align-items: center;
            justify-content: center; cursor: pointer; transition: all 0.3s ease;
        }
        .gallery-nav:hover { background-color: rgba(var(--nord-sym-cyan-rgb), 0.2); border-color: var(--nord-sym-cyan); }
        .gallery-nav i { font-size: 1.75rem; color: var(--nord-sym-text-light); }
        .gallery-nav.prev { left: -30px; }
        .gallery-nav.next { right: -30px; }
        @media (min-width: 640px) { .gallery-nav.prev { left: -50px; } .gallery-nav.next { right: -50px; } }
        .gallery-nav.disabled { opacity: 0.3; cursor: not-allowed; pointer-events: none; }
        @media (max-width: 768px) {
            .gallery-nav {
                display: flex;
                width: 40px; height: 40px;
            }
            .gallery-nav i { font-size: 1.5rem; }
            .gallery-nav.prev { left: 1rem; }
            .gallery-nav.next { right: 1rem; }
        }
        #main-footer {
            border: 1px solid rgba(0, 191, 255, 0.3);
            box-shadow: 0 0 10px rgba(0, 191, 255, 0.1);
        }
        body.labb-active #main-footer {
            display: none !important; /* Total immersion i verkstaden. */
        }
        .footer-quicklinks { display: flex; flex-direction: column; gap: 0.25rem; align-items: center; }
        @media (min-width: 768px) { .footer-quicklinks { align-items: flex-start; } }
        .footer-link { color: var(--nord-sym-text-medium); transition: color 0.3s ease; padding: 0.1rem 0; }
        .footer-link:hover { color: var(--nord-sym-cyan); }
        .nordsym-logo-star {
            color: var(--nord-sym-light-accent);
            animation: nordsym-logo-star-glow 3s infinite ease-in-out;
        }
        @keyframes nordsym-logo-star-glow { 50% { filter: drop-shadow(0 0 12px rgba(var(--nord-sym-light-accent-rgb), 0.8)); } }
        .sr-only {
            position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px;
            overflow: hidden; clip: rect(0, 0, 0, 0); white-space: nowrap; border: 0;
        }
        .legal-content-container { color: var(--nord-sym-text-medium); }
        .legal-content-container h3 {
            font-family: 'Comfortaa', sans-serif; font-size: 1.5rem; font-weight: 700;
            color: var(--nord-sym-text-light); margin-top: 2rem; margin-bottom: 1rem;
            border-bottom: 1px solid rgba(var(--nord-sym-cyan-rgb), 0.2); padding-bottom: 0.5rem;
        }
         .legal-content-container h3:first-of-type { margin-top: 0; }
        .legal-content-container p, .legal-content-container li { font-size: 1rem; line-height: 1.7; margin-bottom: 1rem; }
        .legal-content-container ul { list-style-type: '‚Ä¢ '; padding-left: 1.5rem; }
        .legal-content-container a { color: var(--nord-sym-cyan); text-decoration: underline; transition: color 0.3s; }
        .legal-content-container a:hover { color: var(--nord-sym-light-accent); }
        .hero-headline-glow { animation: hero-glow-animation 5s ease-in-out infinite; }
        @keyframes hero-glow-animation { 50% { text-shadow: 0 0 12px rgba(220, 240, 255, 0.6), 0 0 24px rgba(56, 189, 248, 0.4); } }
        
        #hero-logo-wrapper {
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.22, 1, 0.36, 1);
        }
        #hero-logo-wrapper:hover {
            transform: scale(1.04);
            filter: drop-shadow(0 0 25px rgba(var(--nord-sym-cyan-rgb), 0.5));
        }

        /* --- RITBORDET LOBBY & WORKSHOP RE-ARCHITECTING --- */
        #ritbordet {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: calc(100vh - 116px - 100px); /* Full height minus header/footer estimate */
            padding-top: 4rem;
            padding-bottom: 4rem;
        }

        #ritbordet-lobby {
            transition: opacity 0.4s ease, transform 0.4s ease;
            transform: scale(1);
        }
        body.labb-active #ritbordet-lobby {
            opacity: 0;
            pointer-events: none;
            transform: scale(0.95);
        }

        #ritbordet-lobby .desktop-layout { display: none; }
        @media (min-width: 1024px) {
            #ritbordet-lobby .desktop-layout {
                display: flex;
                flex-direction: column;
                align-items: center;
                gap: 2.5rem;
                max-width: 1200px;
                width: 100%;
            }
        }
        #ritbordet-lobby .mobile-layout { display: block; }
        @media (min-width: 1024px) { #ritbordet-lobby .mobile-layout { display: none; } }

        .ritbordet-grid {
            display: grid;
            gap: 1.5rem;
            width: 100%;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        }
        @media (min-width: 1024px) {
            .ritbordet-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }
        .ritbordet-card {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(var(--nord-sym-cyan-rgb), 0.15);
            padding: 1.5rem;
            text-align: left;
            display: flex;
            flex-direction: column;
        }
        .ritbordet-card i { font-size: 1.75rem; color: var(--nord-sym-cyan); margin-bottom: 0.75rem; }
        .ritbordet-card h4 { font-family: 'Comfortaa', sans-serif; font-size: 1rem; color: var(--nord-sym-text-light); margin-bottom: 0.5rem; }
        .ritbordet-card p { font-size: 0.875rem; color: var(--nord-sym-text-medium); flex-grow: 1; margin-bottom: 1rem; }
        .ritbordet-card button { margin-top: auto; }

        .portal-btn-placeholder { /* Harmoni-fix: Egen klass f√∂r centrering */
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 1rem 0;
        }
        
        #geometry-cta {
            position: relative;
            width: 200px;
            height: 200px;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(var(--nord-sym-cyan-rgb), 0.15) 0%, rgba(var(--nord-sym-deep-space-blue), 0) 70%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: all 0.4s ease;
            border: 1px solid transparent;
        }
        #geometry-cta:hover {
            transform: scale(1.05);
            background: radial-gradient(circle, rgba(var(--nord-sym-cyan-rgb), 0.25) 0%, rgba(var(--nord-sym-deep-space-blue), 0) 70%);
            border-color: rgba(var(--nord-sym-cyan-rgb), 0.3);
            box-shadow: 0 0 30px rgba(var(--nord-sym-cyan-rgb), 0.2);
        }
        #geometry-cta i { font-size: 3rem; color: var(--nord-sym-cyan); transition: all 0.3s ease; }
        #geometry-cta .cta-text { font-weight: 600; color: var(--nord-sym-text-light); margin-top: 0.5rem; transition: all 0.3s ease; }
        #geometry-cta:hover i { transform: rotate(45deg) scale(1.1); }
        #geometry-cta:hover .cta-text { color: var(--nord-sym-cyan); }
        
        #mobile-enter-workshop-btn {
            display: none; /* Hidden by default, shown by JS for mobile lobby */
        }
        body.ritbordet-visible #mobile-enter-workshop-btn {
            display: flex;
            position: fixed;
            bottom: 3rem;
            left: 50%;
            transform: translateX(-50%);
            width: 64px; height: 64px;
            background: rgba(var(--nord-sym-cyan-rgb), 0.15);
            backdrop-filter: blur(8px);
            border: 1px solid var(--nord-sym-cyan);
            border-radius: 50%;
            align-items: center; justify-content: center;
            z-index: 999;
            color: var(--nord-sym-cyan);
            font-size: 2rem;
            box-shadow: 0 0 20px rgba(var(--nord-sym-cyan-rgb), 0.3);
        }
        body.labb-active #mobile-enter-workshop-btn {
            display: none !important;
        }
        @media (min-width: 1024px) { body.ritbordet-visible #mobile-enter-workshop-btn { display: none; } }
        
        #workshop-onboarding {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(12, 20, 39, 0.8); backdrop-filter: blur(10px);
            display: flex; justify-content: center; align-items: center; text-align: center;
            z-index: 2000;
            opacity: 0; pointer-events: none;
            transition: opacity 0.5s ease;
        }
        #workshop-onboarding.visible { opacity: 1; pointer-events: auto; }
        .onboarding-content {
            background: rgba(12, 20, 39, 0.7); border: 1px solid rgba(var(--nord-sym-cyan-rgb), 0.2);
            padding: 3rem; border-radius: 1.5rem; max-width: 500px;
        }
        .onboarding-content h3 { font-family: 'Comfortaa', sans-serif; font-size: 2rem; color: var(--nord-sym-text-light); }
        .esc-hint {
            position: absolute; bottom: 2rem; left: 50%; transform: translateX(-50%);
        }

        .joystick-portal {
            position: fixed;
            bottom: -100px;
            width: 80px; height: 80px;
            border-radius: 50%;
            z-index: 2006;
            display: flex; align-items: center; justify-content: center;
            transition: bottom 0.5s ease, opacity 0.3s ease;
            background: rgba(12, 20, 39, 0.5);
            backdrop-filter: blur(5px);
            border: 1px solid rgba(var(--nord-sym-text-medium), 0.3);
            color: var(--nord-sym-text-medium);
            /* Harmoni-fix: Utrotar scroll-konflikten genom att g√∂ra joysticks helt icke-interaktiva som standard. */
            pointer-events: none;
            opacity: 0;
        }
        .joystick-portal.faded {
            opacity: 0.2;
        }
        .joystick-portal.active { border-color: var(--nord-sym-cyan); color: var(--nord-sym-cyan); }
        .joystick-portal i { font-size: 2rem; }
        #joystick-portal-left { left: 2rem; }
        #joystick-portal-right { right: 2rem; }
        
        @media (max-width: 767px) {
            body.labb-active .joystick-portal { 
                bottom: 1.5rem;
                pointer-events: auto; /* √Öteraktiveras endast i verkstaden */
                opacity: 1;
            }
        }
        
        @media (min-width: 768px) {
             body.labb-active .joystick-portal {
                bottom: 2rem;
                pointer-events: auto;
                opacity: 1;
            }
        }

        /* --- MOBIL VERKSTAD UI-HARMONISERING --- */
        #toolbar-toggle {
            display: none; /* Dold som standard */
            position: fixed;
            left: 1rem;
            top: 10rem; /* Harmoni-fix: Flyttad h√∂gre upp f√∂r att inte st√∂ra joysticken. */
            transform: translateY(-50%);
            z-index: 2005;
            background: rgba(12, 20, 39, 0.5);
            backdrop-filter: blur(5px);
            border: 1px solid rgba(var(--nord-sym-text-medium), 0.3);
            transition: opacity 0.3s ease, transform 0.3s ease;
            width: 44px; height: 44px; /* Harmoni-fix: Matchar de andra knapparna */
            font-size: 1.25rem; /* Harmoni-fix: Ikonstorlek */
        }
        #toolbar-close {
            display: none; /* Dold som standard, visas bara i mobil-verktygsf√§ltet */
        }
        @media (max-width: 767px) {
             /* √Ösidos√§tt den gamla topp-placeringen */
            body.labb-active #elastic-toolbar {
                top: 50%;
                left: -200px; /* B√∂rja utanf√∂r sk√§rmen */
                bottom: auto;
                transform: translateY(-50%);
                transition: left 0.4s cubic-bezier(0.22, 1, 0.36, 1);
                width: auto; /* Harmoni-fix: L√•t inneh√•llet best√§mma bredden. */
            }
            body.labb-active.toolbar-open #elastic-toolbar {
                left: 1rem; /* Glid in */
            }
            body.labb-active #elastic-toolbar .glass-control-group {
                flex-direction: column;
                padding: 0.75rem;
                border-radius: 1rem; /* Harmoni-fix: Ger verktygsf√§ltet en mjukare form. */
            }
            body.labb-active #toolbar-close {
                display: flex;
                margin-bottom: 0.5rem; /* Avst√•nd till de andra knapparna */
            }

            body.labb-active #toolbar-toggle {
                display: flex; /* Visa bara i verkstadsl√§ge p√• mobil */
            }
            /* Harmoni-fix: Tog bort regeln som dolde knappen, nu transformeras den ist√§llet. */

            /* Harmoni-fix: D√∂lj v√§nster joystick n√§r verktygsf√§ltet √§r √∂ppet f√∂r att ge det andrum. */
            body.labb-active.toolbar-open #joystick-portal-left {
                opacity: 0;
                pointer-events: none;
            }
        }
        
        #joystick-portal-right .portal-ring {
            position: absolute; border-radius: 50%; border: 2px solid var(--nord-sym-cyan);
            opacity: 0; transition: all 0.4s ease;
        }
        #joystick-portal-right.active .portal-ring { opacity: 1; }
        .portal-ring-outer { width: 100%; height: 100%; }
        .portal-ring-inner { width: 80%; height: 80%; }
        #joystick-portal-right.active .portal-ring-outer { transform: scale(1.2); }
        #joystick-portal-right.active .portal-ring-inner { transform: scale(0.9); }
        #joystick-portal-right .portal-icon-exit { display: none; }
        body.labb-active #joystick-portal-right .portal-icon-exit { display: block; }
        body.labb-active #joystick-portal-right .portal-icon-enter { display: none; }

        #elastic-toolbar {
            position: fixed; 
            bottom: -100px; 
            left: 50%; 
            transform: translateX(-50%);
            z-index: 2002;
            transition: all 0.5s ease; /* Harmoni-fix: √Ñndrat till 'all' f√∂r att hantera b√•de 'top' och 'bottom'. */
        }
        body.labb-active #elastic-toolbar { bottom: 2rem; }
        .glass-control-group {
            display: flex; gap: 0.5rem;
            background: rgba(12, 20, 39, 0.5); backdrop-filter: blur(10px);
            padding: 0.75rem; border-radius: 99px;
            border: 1px solid rgba(var(--nord-sym-text-light), 0.2);
        }
        .glass-btn {
            width: 44px; height: 44px;
            border-radius: 50%; border: none; background: transparent; color: var(--nord-sym-text-light);
            display: flex; justify-content: center; align-items: center; font-size: 1.25rem;
            cursor: pointer; transition: all 0.3s ease;
        }
        .glass-btn:hover { background: rgba(var(--nord-sym-cyan-rgb), 0.1); color: var(--nord-sym-cyan); }
        .glass-btn.active { background: var(--nord-sym-cyan); color: var(--nord-sym-deep-space-blue); font-weight: bold; }
        .glass-btn svg { width: 24px; height: 24px; }
        #fractal-mode-toggle.glow {
            box-shadow: 0 0 15px rgba(var(--nord-sym-cyan-rgb), 0.7), inset 0 0 5px rgba(var(--nord-sym-cyan-rgb), 0.5);
            color: var(--nord-sym-cyan);
        }
        
        /* --- UNIFIED CANVAS STYLES --- */
        #unified-geometry-canvas {
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            width: 100vw !important;
            height: 100vh !important;
            z-index: -5 !important;
            pointer-events: none !important;
        }
        #unified-geometry-canvas.interactive {
            cursor: grab;
            pointer-events: auto;
        }
        #unified-geometry-canvas.interactive:active {
            cursor: grabbing;
        }
        
        /* FORM NAME DISPLAY in Header */
        #form-name-display {
            position: absolute; /* Harmoni-fix f√∂r perfekt centrering */
            top: 70%; /* Harmoni-fix: Flyttad ned f√∂r att undvika √∂verlappning */
            left: 50%;
            transform: translate(-50%, -50%);
            width: max-content;
            max-width: calc(100% - 200px); /* Undviker √∂verlappning */
            z-index: 1;
            padding: 0.25rem 1rem;
            background: rgba(12, 20, 39, 0);
            color: var(--nord-sym-light-accent);
            font-family: 'Source Code Pro', monospace;
            font-size: 0.875rem;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.5s ease;
            text-transform: capitalize;
            text-align: center;
        }
        @media (max-width: 767px) {
            #form-name-display {
                max-width: calc(100% - 120px);
            }
        }
        body.labb-active #form-name-display.visible {
            opacity: 1;
        }

        /* NEW STYLES FOR ARKITEKTUR PAGE */
        #om-oss .arkitektur-grid {
            display: grid;
            gap: 2rem;
            margin-top: 4rem;
        }
        @media (min-width: 1024px) {
            #om-oss .arkitektur-grid {
                grid-template-columns: 1fr 1fr;
                gap: 4rem;
                align-items: start;
            }
        }
        #om-oss .arkitektur-list {
            list-style: none;
            padding: 0;
            margin-top: 1.5rem;
        }
        #om-oss .arkitektur-list li {
            display: flex;
            align-items: flex-start;
            gap: 1rem;
            margin-bottom: 1rem;
            font-size: 1.125rem;
            color: var(--nord-sym-text-medium);
        }
        #om-oss .arkitektur-list i {
            color: var(--nord-sym-cyan);
            font-size: 1.5rem;
            margin-top: 0.2rem;
            flex-shrink: 0;
        }


    </style>
</head>
<body class="antialiased">
    <header id="header" class="fixed w-full top-0 left-0 right-0 z-40 bg-nord-sym-deep-space-blue/80 backdrop-blur-sm transition-all duration-300">
        <div class="container mx-auto px-4 md:px-6 py-4 flex justify-between items-center"> 
            <a href="#" id="header-logo-link" onclick="window.nord.showPage('hero'); return false;" class="flex-shrink-0">
                <img src="https://raw.githubusercontent.com/GusHem/Logga-utan-text/refs/heads/main/Final%20logo%20no%20text.svg" alt="NordSym Logotyp" class="h-16 md:h-20 transition-all duration-300">
            </a>
            <button id="mobile-menu-trigger" class="md:hidden z-50 text-sky-100">
                <i class="ph ph-list text-3xl"></i>
            </button>
            <nav aria-label="Huvudnavigation" class="hidden md:flex flex-grow justify-center space-x-5 items-center header-nav">
                <a href="#" onclick="window.nord.showPage('hero'); return false;" data-nav="hero" class="nav-link transition-colors font-medium">Hem</a>
                <a href="#" onclick="window.nord.showPage('om-oss'); return false;" data-nav="om-oss" class="nav-link transition-colors font-medium">Arkitektur</a>
                <a href="#" onclick="window.nord.showPage('system'); return false;" data-nav="system" class="nav-link transition-colors font-medium">System</a>
                <a href="#" onclick="window.nord.showPage('ritbordet'); return false;" data-nav="ritbordet" class="nav-link transition-colors font-medium">Ritbordet</a>
                <a href="#" onclick="window.nord.showPage('karriar'); return false;" data-nav="karriar" class="nav-link transition-colors font-medium">G√∂r din del</a>
            </nav>
            <div class="hidden md:flex flex-shrink-0 header-cta"> 
                <a href="#" onclick="window.nord.showPage('boka-samtal-skraddarsydd'); return false;" class="btn-base btn-cta-revised text-sm">Framtidsf√∂rs√§kra er verksamhet</a>
            </div>
            <!-- Form Name Display flyttad utanf√∂r grid-fl√∂det f√∂r absolut centrering -->
            <div id="form-name-display"></div>
        </div>
        <div id="mobile-menu" class="md:hidden bg-nord-sym-deep-space-blue/95 backdrop-blur-sm shadow-lg rounded-b-xl absolute w-full left-0 top-full overflow-hidden transition-all duration-500 ease-in-out max-h-0">
            <a href="#" onclick="window.nord.showPage('hero'); return false;" data-nav="hero" class="block px-6 py-5 text-sky-100 hover:bg-sky-700/50 hover:nord-accent-text transition-colors">Hem</a>
            <a href="#" onclick="window.nord.showPage('om-oss'); return false;" data-nav="om-oss" class="block px-6 py-5 text-sky-100 hover:bg-sky-700/50 hover:nord-accent-text transition-colors">Arkitektur</a>
            <a href="#" onclick="window.nord.showPage('system'); return false;" data-nav="system" class="block px-6 py-5 text-sky-100 hover:bg-sky-700/50 hover:nord-accent-text transition-colors">System</a>
            <a href="#" onclick="window.nord.showPage('ritbordet'); return false;" data-nav="ritbordet" class="block px-6 py-5 text-sky-100 hover:bg-sky-700/50 hover:nord-accent-text transition-colors">Ritbordet</a>
            <a href="#" onclick="window.nord.showPage('karriar'); return false;" data-nav="karriar" class="block px-6 py-5 text-sky-100 hover:bg-sky-700/50 hover:nord-accent-text transition-colors">G√∂r din del</a>
            <div class="px-6 py-5">
                <a href="#" onclick="window.nord.showPage('boka-samtal-skraddarsydd'); return false;" data-nav="kontakt" class="btn-base btn-cta-revised w-full">Framtidsf√∂rs√§kra er verksamhet</a>
            </div>
        </div>
    </header>

    <main> 
        <section id="hero" class="space-background-section">
            <div class="section-content-wrapper">
                <div class="flex flex-col items-center gap-y-8">
                    <div id="hero-logo-wrapper" onclick="window.nord.showPage('om-oss');">
                        <img src="https://raw.githubusercontent.com/GusHem/Logga-utan-text/refs/heads/main/Final%20logo%20no%20text.svg" alt="NordSym Logotyp" width="400" height="114">
                    </div>
                    <h1 class="text-5xl md:text-6xl font-bold leading-tight text-center hero-headline-glow" style="color: var(--nord-sym-light-accent);">
                        System som v√§xer med framtiden
                    </h1>
                    <p class="text-lg md:text-xl text-sky-100 max-w-3xl mx-auto drop-shadow-sm text-center">
                        D√§r er unika process m√∂ter v√•r AI-arkitektur uppst√•r synergi. Vi orkestrerar system som inte bara arbetar f√∂r er ‚Äì de t√§nker med er och utvecklas n√§r AI utvecklas.
                    </p>
                    <div class="flex flex-col items-center gap-6">
                        <div class="flex flex-col md:flex-row items-center gap-4 md:gap-6">
                            <a href="#" onclick="window.nord.showPage('boka-samtal-skraddarsydd'); return false;" class="btn-base btn-cta-revised w-full md:w-auto">Framtidsf√∂rs√§kra er verksamhet</a>
                            <a href="#" onclick="window.nord.showPage('ritbordet'); return false;" class="btn-base btn-secondary-on-dark w-full md:w-auto">Utforska Ritbordet</a>
                        </div>
                         <div class="flex flex-col sm:flex-row gap-4 sm:gap-8 mt-4 text-sm text-sky-300 justify-center">
                            <span>Fr√•n start till v√§rde p√• 14 dagar</span>
                            <span>Byggt p√• bepr√∂vade m√∂nster</span>
                            <span>üá∏üá™ Svensk ingenj√∂rskonst</span>
                        </div>
                    </div>
                </div>
            </section>
        </section>
        
        <section id="home-diagram-section" class="space-background-section py-16 lg:py-24">
            <div class="section-content-wrapper">
                <div class="text-center mb-16 max-w-4xl mx-auto">
                    <h2 class="section-title text-4xl md:text-5xl mb-4">D√§r er expertis m√∂ter v√•r arkitektur.</h2>
                    <p class="text-lg text-sky-200 mt-6 leading-relaxed">Vi f√∂rvandlar er unika process till ett intelligent, sj√§lvg√•ende ekosystem.</p>
                </div>
                <div class="venn-diagram-container">
                    <div class="venn-diagram-wrapper">
                        <div class="venn-circle venn-circle-1">
                            <span class="venn-circle-text">Er Verksamhet</span>
                        </div>
                        <div class="venn-circle venn-circle-2">
                             <span class="venn-circle-text">V√•r Arkitektur</span>
                        </div>
                        <div class="venn-overlap-text" onclick="window.nord.showPage('system'); return false;">Intelligent Kapacitet</div>
                    </div>
                </div>
            </div>
        </section>

        <section id="atom-gallery-section" class="space-background-section py-20 lg:py-28">
            <div class="section-content-wrapper">
                <div class="text-center mb-16">
                    <span class="inline-block bg-sky-800/50 text-sky-200 text-xs font-semibold px-3 py-1 rounded-full uppercase tracking-wider">V√•r Arkitektur</span>
                    <h3 class="text-3xl md:text-4xl font-bold text-white mt-4">V√•ra Byggstenar</h3>
                    <p class="text-center text-sky-200 max-w-3xl mx-auto mt-4 mb-8">
                        Dessa √§r de bepr√∂vade grundelementen i v√•r arkitektur. Fr√•n denna palett av intelligens komponerar vi allt fr√•n fokuserade Micro-SaaS-l√∂sningar till kompletta, sj√§lvg√•ende ekosystem. <a href='#home-contact-anchor' onclick='event.preventDefault(); window.nord.smoothScrollTo("#home-contact-anchor");' class='text-nord-sym-cyan hover:underline font-semibold whitespace-nowrap'>Se hur de kan kombineras f√∂r er.</a>
                    </p>
                </div>
                <div class="gallery-container">
                    <div class="gallery-viewport">
                        <div id="galleryWrapper" class="gallery-wrapper">
                            <!-- Cards are dynamically injected by JS -->
                        </div>
                    </div>
                    <button aria-label="F√∂reg√•ende system i galleriet" id="galleryPrev" class="gallery-nav prev"><i class="ph-caret-left-bold"></i></button>
                    <button aria-label="N√§sta system i galleriet" id="galleryNext" class="gallery-nav next"><i class="ph-caret-right-bold"></i></button>
                </div>
                <div class="text-center mt-12">
                    <p class="text-lg text-sky-300 animate-pulse"><i class="ph-arrows-left-right"></i> Utforska byggstenarna <i class="ph-arrows-left-right"></i></p>
                </div>
            </div>
        </section>

        <section id="home-contact-section" class="space-background-section py-20 lg:py-28">
            <div id="home-contact-anchor" class="absolute -top-24"></div>
            <div class="section-content-wrapper">
                 <div class="text-center mt-12 border-t border-sky-800/50 pt-16">
                    <h3 class="text-3xl font-bold text-white">Redo att p√•b√∂rja er evolution?</h3>
                    <p class="text-lg text-content-dark-bg max-w-2xl mx-auto mt-4 mb-8">L√•t oss boka ett strategisamtal f√∂r att definiera er arkitektur och p√•b√∂rja er transformation.</p>
                    <a href="#" onclick="window.nord.showPage('boka-samtal-skraddarsydd'); return false;" class="btn-base btn-cta-revised px-10 py-4 text-lg">Framtidsf√∂rs√§kra er verksamhet</a>
                </div>
            </div>
        </section>

        <section id="om-oss" class="space-background-section page-content-padding" style="display: none;">
            <div class="section-content-wrapper max-w-5xl mx-auto text-lg text-sky-100 leading-relaxed">
                <div class="text-center mb-16">
                    <h2 class="section-title text-4xl md:text-5xl">Vi bygger system f√∂r morgondagen.</h2>
                    <p class="mt-6 max-w-3xl mx-auto">
                        I en v√§rld av snabba teknologiskiften designar NordSym intelligenta system byggda f√∂r att best√•. V√•r grundfilosofi √§r enkel: sann teknologisk frihet uppn√•s genom modul√§r arkitektur som v√§xer och anpassar sig med ert f√∂retag ‚Äì inte l√•ser in det.
                    </p>
                </div>

                <div class="text-center my-16 py-10 border-y border-sky-800/50">
                     <h3 class="section-title text-3xl md:text-4xl">Frihet √∂ver inl√•sning.</h3>
                     <p class="mt-6 max-w-3xl mx-auto">
                        Vi anv√§nder dagens b√§sta och mest kraftfulla AI-verktyg f√∂r att ge er ett omedelbart f√∂rspr√•ng. Men vi bygger alltid f√∂r morgondagens frihet. V√•ra system designas med 'exit-ramps' ‚Äì en medveten arkitektur som s√§kerst√§ller att ni aldrig blir permanent beroende av en enskild teknikleverant√∂r. N√§r en b√§ttre, snabbare eller mer kostnadseffektiv AI-modell dyker upp, √§r era system redo att v√§xla. Vi prioriterar <strong>portabilitet</strong> √∂ver <strong>vendor lock-in</strong>, eftersom er framtid √§r viktigare √§n v√•r kortsiktiga bekv√§mlighet.
                     </p>
                </div>
                
                <div class="text-center mb-16">
                    <h3 class="section-title text-3xl md:text-4xl">Teknologi som tj√§nar m√§nniskan.</h3>
                    <p class="mt-6 max-w-3xl mx-auto">
                        V√•rt m√•l √§r inte snabba exits eller att bli uppk√∂pta. Vi bygger f√∂r att best√• och f√∂r att skapa l√•ngsiktiga partnerskap. Vi tror p√• teknologi som st√§rker f√∂retag och de familjer som driver dem, som skapar stabilitet och m√∂jligg√∂r fokus p√• det som verkligen betyder n√•got. F√∂r oss √§r den mest avancerade teknologin den som s√∂ml√∂st tj√§nar er, inte tv√§rtom.
                    </p>
                </div>

                <div class="arkitektur-grid content-card-transparent card-base p-8 md:p-12">
                    <div>
                        <h4 class="section-title text-2xl md:text-3xl mb-4">Grundaren</h4>
                        <p>
                            <strong>Gustav Hemmingsson</strong> grundade NordSym med en tydlig vision: att f√∂retag och familjer ska √§ga sin teknologi, inte bli √§gda av den. Med en bakgrund som str√§cker sig √∂ver b√•de avancerad systemarkitektur och strategisk aff√§rsutveckling, f√∂rst√•r han att den b√§sta tekniken √§r den som bara fungerar ‚Äì och ger er friheten att fokusera p√• er k√§rnverksamhet.
                        </p>
                    </div>
                    <div>
                        <h4 class="section-title text-2xl md:text-3xl mb-4">Ett fundament att lita p√•</h4>
                        <ul class="arkitektur-list">
                            <li><i class="ph-leaf"></i> <div><strong>Organisk Tillv√§xt:</strong> Byggt p√• f√∂rtroende och resultat, fritt fr√•n yttre investerarkrav.</div></li>
                            <li><i class="ph-stack"></i> <div><strong>Bepr√∂vad Teknologi:</strong> En k√§rna av n8n-automation, flexibel AI-integration och nordisk precision i varje detalj.</div></li>
                            <li><i class="ph-target"></i> <div><strong>Kundcentrerad Optimering:</strong> Vi √§r inte bundna till en specifik teknik; vi √§r bundna till att bygga den b√§sta, mest h√•llbara l√∂sningen f√∂r er.</div></li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>

        <section id="system" class="space-background-section page-content-padding" style="display: none;">
            <div class="section-content-wrapper flex-grow">
                <div class="text-center mb-20">
                     <span class="inline-block bg-sky-800/50 text-sky-200 text-xs font-semibold px-3 py-1 rounded-full uppercase tracking-wider">System</span>
                    <h3 class="text-3xl md:text-4xl font-bold text-white mt-4">En Transformation i Tre Steg</h3>
                     <p class="text-lg text-content-dark-bg max-w-3xl mx-auto mt-4">V√•r arsenal av bepr√∂vade system √§r er startpunkt. H√§rifr√•n bygger vi er unika evolution.</p>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-8 max-w-6xl mx-auto items-stretch">
                    <div class="pricing-card card-base">
                        <div class="pricing-card-header text-center">
                            <h3>GRUND</h3>
                             <p class="text-sm text-sky-300 mt-2">En fokuserad transformation. M√§tbart resultat.</p>
                        </div>
                        <div class="price-display text-center">75k <span class="price-period">SEK</span></div>
                        <ul>
                            <li><i class="ph-check-circle"></i> En fundamental automationsl√∂sning</li>
                            <li><i class="ph-check-circle"></i> Perfekt f√∂r att testa och validera potentialen i automation</li>
                            <li><i class="ph-check-circle"></i> Snabb implementation f√∂r omedelbar ROI</li>
                            <li><i class="ph-check-circle"></i> Mer √§n ett fl√∂de ‚Äì det √§r den f√∂rsta, fullt integrerade komponenten i ert framtida ekosystem, inklusive all n√∂dv√§ndig arkitektur f√∂r att v√§xa.</li>
                        </ul>
                        <div class="mt-auto">
                            <a href="#" onclick="window.nord.showPage('boka-samtal-skraddarsydd'); return false;" class="btn-base btn-secondary-on-dark w-full">Starta med Grunden</a>
                        </div>
                    </div>
                    <div class="pricing-card card-base ignite-package">
                         <div class="pricing-card-header text-center">
                            <h3>STRUKTUR</h3>
                             <p class="text-sm text-sky-300 mt-2">Sammankopplade system. Exponentiell effekt.</p>
                        </div>
                        <div class="price-display text-center">250k <span class="price-period">SEK</span></div>
                         <ul>
                            <li><i class="ph-check-circle"></i> Ett ekosystem av agenter</li>
                            <li><i class="ph-check-circle"></i> Byggd p√• bepr√∂vad arkitektur</li>
                            <li><i class="ph-check-circle"></i> Transformerar en hel avdelning eller process</li>
                            <li><i class="ph-check-circle"></i> Inkluderar ofta ett skr√§ddarsytt gr√§nssnitt</li>
                        </ul>
                         <div class="mt-auto">
                            <a href="#" onclick="window.nord.showPage('boka-samtal-skraddarsydd'); return false;" class="btn-base btn-cta-revised w-full">Forma er Struktur</a>
                        </div>
                    </div>
                    <div class="pricing-card card-base">
                         <div class="pricing-card-header text-center">
                            <h3>ARKITEKTUR</h3>
                             <p class="text-sm text-sky-300 mt-2">En komplett, framtidss√§krad systemarkitektur.</p>
                        </div>
                        <div class="price-display text-center">500k+ <span class="price-period">SEK</span></div>
                         <ul>
                            <li><i class="ph-check-circle"></i> Fullskalig systemtransformation</li>
                            <li><i class="ph-check-circle"></i> Ett intelligent ekosystem som v√§xer med er</li>
                            <li><i class="ph-check-circle"></i> Designad f√∂r obegr√§nsad evolution och anpassning</li>
                            <li><i class="ph-check-circle"></i> Er framtidsf√∂rs√§kring mot teknisk obsolescence</li>
                        </ul>
                         <div class="mt-auto">
                            <a href="#" onclick="window.nord.showPage('boka-samtal-skraddarsydd'); return false;" class="btn-base btn-secondary-on-dark w-full">Etablera er Arkitektur</a>
                        </div>
                    </div>
                </div>
                <div class="text-center mt-16 max-w-3xl mx-auto">
                    <p class="text-lg text-sky-200"><strong>15k SEK/m√•nad</strong> f√∂r framtidsbevakning och kontinuerlig evolution.</p>
                    <p class="text-md text-sky-300 mt-2 italic">"N√§r teknologin tar ett spr√•ng fram√•t, ser vi till att era system redan √§r d√§r."</p>
                </div>
            </div>
        </section>

        <section id="ritbordet" class="space-background-section" style="display: none;">
            <div id="ritbordet-lobby" class="section-content-wrapper">
                <div class="max-w-5xl mx-auto w-full">
                    <!-- Desktop Layout -->
                    <div class="desktop-layout">
                        <div class="ritbordet-grid" id="ritbordet-grid-top">
                            <!-- Process cards injected by JS -->
                        </div>
                        <div class="portal-btn-placeholder">
                            <div id="geometry-cta" onclick="window.UnifiedGeometryManager.enterBuilderMode()">
                                <i class="ph ph-cube"></i>
                                <span class="cta-text">Forma er Arkitektur</span>
                            </div>
                        </div>
                        <div class="ritbordet-grid" id="ritbordet-grid-bottom">
                            <!-- Value cards injected by JS -->
                        </div>
                    </div>
                    <!-- Mobile Layout -->
                    <div class="mobile-layout" id="mobile-lobby-content">
                         <!-- Mobile cards injected by JS -->
                    </div>
                </div>
            </div>
        </section>

        <section id="karriar" class="space-background-section page-content-padding" style="display: none;">
            <div class="section-content-wrapper text-center">
                 <div class="flex justify-center space-x-2 mb-8 md:mb-10">
                    <i class="ph-star-four nordsym-logo-star text-3xl" style="animation-delay: 0.1s;"></i>
                    <i class="ph-star-four nordsym-logo-star text-4xl" style="animation-delay: 0.3s;"></i>
                    <i class="ph-star-four nordsym-logo-star text-3xl" style="animation-delay: 0.5s;"></i>
                </div>
                <h2 class="section-title text-4xl md:text-5xl lg:text-6xl mb-8 md:mb-12">G√∂r din del i <span class="section-title-accent relative">systemrevolutionen</span></h2>
                <div class="max-w-3xl lg:max-w-4xl mx-auto">
                    <p class="text-lg md:text-xl leading-relaxed">
                        Vi bygger inte bara funktioner, vi bygger skalbara ekosystem som levererar m√§tbart aff√§rsresultat. Vi s√∂ker m√•ngsidiga arkitekter som vill transformera hur f√∂retag fungerar i grunden.
                    </p>
                    <p class="text-lg md:text-xl leading-relaxed mt-6">
                        Om du √§r en entrepren√∂riell t√§nkare som vill bygga system med best√•ende inverkan, har du hittat r√§tt.
                    </p>
                </div>
                <div class="mt-12 md:mt-16 mb-10">
                    <a href="#" onclick="window.nord.showPage('vilka-ar-vi'); return false;" class="btn-base btn-secondary-on-dark px-10 py-4 text-lg lg:text-xl lg:px-12 lg:py-5">
                        Starta Din Resa <i class="ph-paper-plane-tilt ml-2"></i>
                    </a>
                </div>
            </div>
        </section>
        
        <section id="vilka-ar-vi" class="space-background-section page-content-padding" style="display: none;">
            <div class="section-content-wrapper text-center" id="vilka-ar-vi-content">
                <h2 class="text-4xl md:text-5xl font-extrabold text-white mb-8">Vilka √§r vi?</h2>
                <div class="max-w-2xl mx-auto text-left text-sky-100">
                     <p class="text-lg mb-6">
                        Vi √§r <strong>arkitekter av intelligenta ekosystem</strong>. V√•rt fokus √§r att bygga AI-drivna system som √§r designade att samverka och f√∂rst√§rka varandra. V√•r vision √§r "Framtiden F√∂renklad", d√§r avancerad teknologi blir ett kraftfullt och tillg√§ngligt verktyg f√∂r f√∂retag som vill ligga i framkant.
                    </p>
                     <p class="text-lg mb-10">
                        √Ñr du redo att ansluta dig till ett team som drivs av "Nordisk Atom-Optimism"?
                    </p>
                </div>
                <div id="jobApplicationFormContainer" class="content-card-dark card-base p-8 md:p-12 mt-10 max-w-2xl mx-auto text-left form-container"> 
                    <h3 class="text-2xl font-semibold text-heading-dark-bg mb-6 text-center">Anslut Till Teamet p√• NordSym</h3>
                    <div class="form-progress-bar">
                        <div class="form-progress-bar-inner"></div>
                    </div>
                    <form id="jobApplicationForm">
                        <input type="hidden" name="_subject" value="Ny jobbans√∂kan fr√•n NordSym">
                        <div class="form-step active" data-step="1">
                            <div class="space-y-6">
                                <div>
                                    <label for="applicant-name" class="form-label">Ditt Namn</label>
                                    <input type="text" name="applicant-name" id="applicant-name" required class="form-input">
                                </div>
                                <div>
                                    <label for="applicant-email" class="form-label">E-post</label>
                                    <input type="email" name="email" id="applicant-email" required class="form-input">
                                </div>
                            </div>
                            <div class="form-navigation">
                                <span></span>
                                <button type="button" class="btn-base btn-cta-revised">N√§sta <i class="ph-arrow-right"></i></button>
                            </div>
                        </div>
                        <div class="form-step" data-step="2">
                             <div class="space-y-6">
                                <div>
                                    <label for="applicant-linkedin" class="form-label">LinkedIn-profil (URL)</label>
                                    <input type="url" name="linkedin" id="applicant-linkedin" class="form-input" placeholder="https://linkedin.com/in/dittnamn">
                                </div>
                                <div>
                                    <label for="applicant-motivation" class="form-label">Varf√∂r vill du jobba med oss p√• NordSym?</label>
                                    <textarea name="motivation" id="applicant-motivation" rows="4" class="form-textarea" required placeholder="Ber√§tta kort om din motivation och hur du kan bidra."></textarea>
                                </div>
                            </div>
                            <div class="form-navigation">
                                <button type="button" class="btn-base btn-secondary-on-dark"><i class="ph-arrow-left"></i> F√∂reg√•ende</button>
                                <button type="submit" class="btn-base btn-cta-revised">Skicka Intresseanm√§lan</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </section>

        <section id="boka-samtal-skraddarsydd" class="space-background-section page-content-padding" style="display: none;">
            <div class="section-content-wrapper text-center">
                <h2 class="text-4xl md:text-5xl font-extrabold text-white mb-8">Starta er systemresa</h2>
                <p class="text-lg text-content-dark-bg max-w-xl mx-auto mb-10">Det f√∂rsta steget mot ett sj√§lvg√•ende ekosystem. L√•t oss diskutera er vision.</p>
                <div id="formSkraddarsyddContainer" class="content-card-transparent card-base p-8 md:p-12 mt-10 max-w-lg mx-auto text-left form-container">
                    <h3 class="text-2xl font-semibold text-heading-dark-bg mb-6 text-center">Kontaktinformation</h3>
                    <div class="form-progress-bar">
                        <div class="form-progress-bar-inner"></div>
                    </div>
                    <form id="formSkraddarsydd">
                        <input type="hidden" name="_subject" value="Ny f√∂rfr√•gan: Systemdiskussion fr√•n NordSym">
                        <div class="form-step active" data-step="1">
                            <div class="space-y-6">
                                <div><label for="skraddarsydd-name" class="form-label">Ditt Namn</label><input type="text" name="name" id="skraddarsydd-name" required class="form-input"></div>
                                <div><label for="skraddarsydd-company" class="form-label">F√∂retagsnamn</label><input type="text" name="company" id="skraddarsydd-company" required class="form-input"></div>
                                <div><label for="skraddarsydd-email" class="form-label">E-post</label><input type="email" name="email" id="skraddarsydd-email" required class="form-input"></div>
                            </div>
                             <div class="form-navigation">
                                <span></span>
                                <button type="button" class="btn-base btn-cta-revised">N√§sta <i class="ph-arrow-right"></i></button>
                            </div>
                        </div>
                        <div class="form-step" data-step="2">
                            <div class="space-y-6">
                                <div><label for="skraddarsydd-phone" class="form-label">Telefon (valfritt)</label><input type="tel" name="phone" id="skraddarsydd-phone" class="form-input"></div>
                                <div><label for="skraddarsydd-main-goal" class="form-label">Vad √§r det viktigaste ni vill automatisera eller f√∂rb√§ttra?</label><textarea name="main-goal" id="skraddarsydd-main-goal" rows="3" class="form-textarea" required></textarea></div>
                            </div>
                            <div class="form-navigation">
                                <button type="button" class="btn-base btn-secondary-on-dark"><i class="ph-arrow-left"></i> F√∂reg√•ende</button>
                                <button type="submit" class="btn-base btn-cta-revised">Boka diskussion</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </section>
        
        <section id="privacy-policy-en" class="space-background-section page-content-padding" style="display: none;">
            <div class="section-content-wrapper">
                <div class="legal-content-container max-w-4xl mx-auto text-left">
                    <h2 class="section-title text-4xl md:text-5xl mb-8 text-center">Privacy Policy</h2>
                    <p><strong>Last Updated: July 3, 2025</strong></p>
                    <h4>About This Policy</h4><p>NordSym AB (Swedish Org. No. 559535-5768) values your trust and privacy. This Privacy Policy describes how we collect, use, and protect your personal data when you visit our website or use our services.</p>
                    <h4>Who We Are</h4><p>NordSym AB<br>Organization Number: 559535-5768<br>Email: <a href="mailto:gustav@nordsym.com">gustav@nordsym.com</a><br>Website: nordsym.com</p><p>We are the data controller for the processing of personal data described in this policy.</p>
                    <h4>What Personal Data We Collect</h4><ul><li><strong>Contact Forms and Inquiries:</strong> Name and contact details (email, phone), company information, job title, and a description of your needs.</li><li><strong>Job Applications:</strong> Name, contact details, CV, professional background, relevant links (LinkedIn, etc.), and a motivational description.</li><li><strong>Website Usage:</strong> Anonymized IP address, browser information, and user interaction via cookies.</li><li><strong>Client and Project Data:</strong> Business processes, technical requirements, and communication history necessary for project delivery.</li></ul>
                    <h4>Why We Process Your Personal Data</h4><p>We process your data to fulfill our commitments (Art. 6.1.b GDPR), such as responding to inquiries and delivering services. We also have a legitimate interest (Art. 6.1.f GDPR) in developing our services and communicating with potential clients. For certain marketing activities, we obtain your consent (Art. 6.1.a GDPR).</p>
                    <h4>Data Sharing and Third Parties</h4><p>We use trusted service providers such as Formspree, Google Analytics, Microsoft 365, Notion, Airtable, GitHub, and leading AI platforms (Anthropic, OpenAI) as well as automation tools (Make, n8n) to conduct our business. All providers are selected to comply with GDPR requirements. We ensure an adequate level of protection for any transfers of data outside the EU/EEA.</p>
                    <h4>Your Rights</h4><p>You have the right to access, rectify, erase, restrict, and port your personal data, and to object to its processing. You can also withdraw your consent at any time. Contact <a href="mailto:gustav@nordsym.com">gustav@nordsym.com</a> to exercise your rights.</p>
                    <h4>Contact and Complaints</h4><p>For questions, contact us at <a href="mailto:gustav@nordsym.com">gustav@nordsym.com</a>. Complaints can be filed with the Swedish Authority for Privacy Protection (IMY).</p>
                </div>
            </div>
        </section>

        <section id="terms-of-service-en" class="space-background-section page-content-padding" style="display: none;">
            <div class="section-content-wrapper">
                <div class="legal-content-container max-w-4xl mx-auto text-left">
                    <h2 class="section-title text-4xl md:text-5xl mb-8 text-center">Terms of Service</h2>
                    <p><strong>Last Updated: July 3, 2025</strong></p>
                    <h4>General</h4><p>These Terms of Service govern your use of the NordSym AB ("we", "us", "NordSym") website (nordsym.com) and services. By using our services, you accept these terms.</p>
                    <h4>User Responsibilities</h4><p>You are responsible for providing accurate information and for not using our services for illegal purposes. You may not reverse engineer our systems or resell our services without written approval.</p>
                    <h4>Intellectual Property and Data Ownership</h4><p>NordSym √§ger v√•ra algoritmer, metoder och ramverk. Du som kund beh√•ller full √§gander√§tt till dina aff√§rsdata och de specifika resultat som genereras av dina data. F√∂r skr√§ddarsydda AI-agenter utvecklade specifikt f√∂r dig, tillh√∂r √§gander√§tten dig, medan den underliggande tekniska plattformen f√∂rblir v√•r egendom.</p>
                    <h4>Limitation of Liability</h4><p>We are not liable for indirect damages such as lost profits or data. Our total liability is limited to the amount paid for the specific service. We do not guarantee specific business results or ROI, although that is our goal.</p>
                    <h4>Governing Law and Disputes</h4><p>These terms are governed by Swedish law. Disputes shall primarily be resolved through negotiation. If an agreement cannot be reached, the dispute shall be settled by a Swedish court.</p>
                </div>
            </div>
        </section>
    </main>
    
    <footer id="main-footer" class="relative bg-nord-sym-deep-space-blue">
        <div class="section-content-wrapper py-10 relative z-10">
            <div class="grid md:grid-cols-3 gap-8 text-sm">
                <div class="md:col-span-1 flex flex-col items-center md:items-start text-center md:text-left">
                    <a href="#" onclick="window.nord.showPage('hero'); return false;" class="inline-block mb-4">
                        <img src="https://raw.githubusercontent.com/GusHem/Logga-utan-text/refs/heads/main/Final%20logo%20no%20text.svg" alt="NordSym Logotyp" class="h-16" loading="lazy" decoding="async">
                    </a>
                    <p class="text-xs text-content-dark-bg">Intelligenta system med m√§nsklig insikt och teknologisk precision.</p>
                </div>
                <div class="md:col-span-1 text-center md:text-left">
                    <p class="font-semibold text-nord-sym-text-light mb-2">Snabbl√§nkar</p>
                    <div class="footer-quicklinks">
                        <a href="#" onclick="window.nord.showPage('om-oss'); return false;" class="footer-link">Arkitektur</a>
                        <a href="#" onclick="window.nord.showPage('system'); return false;" class="footer-link">System</a>
                        <a href="#" onclick="window.nord.showPage('ritbordet'); return false;" class="footer-link">Ritbordet</a>
                        <a href="#" onclick="window.nord.showPage('karriar'); return false;" class="footer-link">G√∂r din del</a>
                    </div>
                </div>
                <div class="md:col-span-1 text-center md:text-left">
                     <p class="font-semibold text-nord-sym-text-light mb-2">F√∂lj Oss</p>
                     <div class="footer-quicklinks">
                        <a href="https://www.linkedin.com/company/nordsym-ab/" target="_blank" rel="noopener noreferrer" class="footer-link inline-flex items-center gap-2"><i class="ph-linkedin-logo"></i>LinkedIn</a>
                        <a href="https://x.com/NordSym" target="_blank" rel="noopener noreferrer" class="footer-link inline-flex items-center gap-2"><i class="ph-twitter-logo"></i>X (Twitter)</a>
                        <a href="https://www.instagram.com/nordsym_ab/" target="_blank" rel="noopener noreferrer" class="footer-link inline-flex items-center gap-2"><i class="ph-instagram-logo"></i>Instagram</a>
                    </div>
                </div>
            </div>
            <div class="mt-8 border-t border-sky-700/50 pt-6 text-center text-xs text-content-dark-bg space-x-4">
                <span>¬© <span id="currentYear"></span> NordSym AB. Alla r√§ttigheter f√∂rbeh√•llna.</span>
                <a href="#privacy-policy-en" onclick="window.nord.showPage('privacy-policy-en'); return false;" class="footer-link hover:underline ml-4">Privacy Policy</a>
                <a href="#terms-of-service-en" onclick="window.nord.showPage('terms-of-service-en'); return false;" class="footer-link hover:underline">Terms of Service</a>
            </div>
        </div>
    </footer>
    
    <!-- === UI OVERLAYS & FIXED CONTROLS (ARKITEKTONISK SEPARATION) === -->
    <div id="workshop-onboarding">
        <div class="onboarding-content">
            <h3>V√§lkommen till Ritbordet</h3>
            <p class="text-lg">H√§r visualiserar vi hur era processer kan transformeras till intelligenta system. Varje form representerar en unik l√∂sningsarkitektur.</p>
            <div class="my-4 text-left max-w-xs mx-auto space-y-2">
                <p><strong class="nord-accent-text">Transformera:</strong> Uppt√§ck olika l√∂sningsv√§gar</p>
                <p><strong class="nord-accent-text">Rotera:</strong> Se m√∂jligheter fr√•n nya vinklar</p>
            </div>
            <p class="font-semibold text-sky-200 italic">Systemt√§nkande i realtid.</p>
            <p class="mt-4 text-xs text-sky-400 esc-hint">(√Öterv√§nd med ESC eller X)</p>
        </div>
    </div>

    <button id="mobile-enter-workshop-btn" onclick="window.UnifiedGeometryManager.enterBuilderMode()">
        <i class="ph ph-cube"></i>
    </button>
    <button id="toolbar-toggle" class="glass-btn" title="Visa verktyg">
        <i class="ph ph-list"></i>
    </button>
    <button id="joystick-portal-left" class="joystick-portal" title="Rotationskontroll">
        <i class="ph ph-arrows-out-cardinal"></i>
    </button>
    <button id="joystick-portal-right" class="joystick-portal" title="G√• in/ut ur verkstad">
        <div class="portal-ring portal-ring-outer"></div>
        <div class="portal-ring portal-ring-inner"></div>
        <i class="ph-atom portal-icon-enter"></i>
        <i class="ph-x portal-icon-exit"></i>
    </button>

    <div id="elastic-toolbar">
        <div class="glass-control-group">
            <button class="glass-btn" data-theme="fundamental" title="Grundl√§ggande">‚óé</button>
            <button class="glass-btn" data-theme="struktur" title="Struktur">‚óâ</button>
            <button class="glass-btn" data-theme="flode" title="Fl√∂de">‚óä</button>
            <button class="glass-btn" data-theme="precision" title="Precision">Œ®</button>
            <button class="glass-btn" data-theme="paradigm" title="Paradigm">‚àû</button>
            <button class="glass-btn" data-theme="ekosystem" title="Ekosystem">‚ü†</button>
            <button class="glass-btn" id="fractal-mode-toggle" title="Partikel-manifestation">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2 C 17 7, 7 17, 2 12 C 7 7, 17 17, 22 12 C 17 7, 7 7, 12 2"></path></svg>
            </button>
        </div>
    </div>
    
    <script id="simplex-noise-glsl" type="x-shader/x-fragment">
        // Simplex Noise GLSL implementation
        vec3 mod289(vec3 x) { return x - floor(x * (1.0 / 289.0)) * 289.0; }
        vec4 mod289(vec4 x) { return x - floor(x * (1.0 / 289.0)) * 289.0; }
        vec4 permute(vec4 x) { return mod289(((x*34.0)+1.0)*x); }
        vec4 taylorInvSqrt(vec4 r) { return 1.79284291400159 - 0.85373472095314 * r; }

        float snoise(vec3 v) {
            const vec2 C = vec2(1.0/6.0, 1.0/3.0);
            const vec4 D = vec4(0.0, 0.5, 1.0, 2.0);
            vec3 i  = floor(v + dot(v, C.yyy));
            vec3 x0 = v - i + dot(i, C.xxx);
            vec3 g = step(x0.yzx, x0.xyz);
            vec3 l = 1.0 - g;
            vec3 i1 = min(g.xyz, l.zxy);
            vec3 i2 = max(g.xyz, l.zxy);
            vec3 x1 = x0 - i1 + C.xxx;
            vec3 x2 = x0 - i2 + C.yyy;
            vec3 x3 = x0 - D.yyy;
            i = mod289(i);
            vec4 p = permute(permute(permute(i.z + vec4(0.0, i1.z, i2.z, 1.0)) + i.y + vec4(0.0, i1.y, i2.y, 1.0)) + i.x + vec4(0.0, i1.x, i2.x, 1.0));
            float n_ = 0.142857142857; // 1.0/7.0
            vec3 ns = n_ * D.wyz - D.xzx;
            vec4 j = p - 49.0 * floor(p * ns.z * ns.z);
            vec4 x_ = floor(j * ns.z);
            vec4 y_ = floor(j - 7.0 * x_);
            vec4 x = x_ * ns.x + ns.yyyy;
            vec4 y = y_ * ns.x + ns.yyyy;
            vec4 h = 1.0 - abs(x) - abs(y);
            vec4 b0 = vec4(x.xy, y.xy);
            vec4 b1 = vec4(x.zw, y.zw);
            vec4 s0 = floor(b0)*2.0 + 1.0;
            vec4 s1 = floor(b1)*2.0 + 1.0;
            vec4 sh = -step(h, vec4(0.0));
            vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy;
            vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww;
            vec3 p0 = vec3(a0.xy,h.x);
            vec3 p1 = vec3(a0.zw,h.y);
            vec3 p2 = vec3(a1.xy,h.z);
            vec3 p3 = vec3(a1.zw,h.w);
            vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2,p2), dot(p3,p3)));
            p0 *= norm.x; p1 *= norm.y; p2 *= norm.z; p3 *= norm.w;
            vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);
            m = m * m;
            return 42.0 * dot(m*m, vec4(dot(p0,x0), dot(p1,x1), dot(p2,x2), dot(p3,x3)));
        }
    </script>

    <script>
    /**
     * ATOMSMED vFINAL: TOTAL HARMONI (Anti-Fragile Manifestation)
     * "Fr√•n universum till anv√§ndare. Klarhet genom magi, inte trots den."
     * MANIFESTATION PROTOCOL: Systemet har uppn√•tt universell harmoni. Alla dimensioner √§r synkroniserade.
     */

    // --- GLOBAL NAMESPACE & STATE MANAGEMENT ---
    window.nord = {};
    window.UnifiedGeometryManager = null;

    const SACRED_GEOMETRY_LIBRARY = {
        fundamental: {
            material: 'neural', // Harmoni-fix: √Öterst√§ller den solida grundformen.
            forms: [
                // Harmoni-fix: En spr√•klig makeover f√∂r en mer kraftfull ber√§ttelse.
                { name: 'potential', displayName: 'Ursprung' },
                { name: 'relation', displayName: 'Koppling' },
                { name: 'structure', displayName: 'Ramverk' },
                { name: 'adaptation', displayName: 'Formning' },
                { name: 'synergy', displayName: 'Syntes' }
            ],
            currentIndex: 0
        },
        struktur: { 
            material: 'neural', 
            forms: [
                { name: 'tetrahedron', displayName: 'Tetrahedron' }, 
                { name: 'cube', displayName: 'Kub' }, 
                { name: 'octahedron', displayName: 'Oktahedron' }, 
                { name: 'dodecahedron', displayName: 'Dodekahedron' }, 
                { name: 'icosahedron', displayName: 'Ikosahedron' }
            ], 
            currentIndex: 0 
        },
        flode: { 
            material: 'organic', 
            forms: [
                { name: 'seed_of_life', displayName: 'K√§rna' }, 
                { name: 'flower_of_life', displayName: 'N√§tverk' }, 
                { name: 'metatrons_cube', displayName: 'Matris' }, 
                { name: 'torus', displayName: 'Torus' }, 
                { name: 'trinity_knot', displayName: 'Treenighetsknut' }
            ], 
            currentIndex: 0 
        },
        precision: { 
            material: 'crystal', 
            forms: [
                { name: 'diamond_brilliant', displayName: 'Briljant' }, 
                { name: 'quartz_point', displayName: 'Bergkristall' }, 
                { name: 'bismuth_spiral', displayName: 'Vismutkristall' }, 
                { name: 'geode', displayName: 'Geod' }, 
                { name: 'prism_triangular', displayName: 'Prisma' }
            ], 
            currentIndex: 0 
        },
        paradigm: { 
            material: 'quantum', 
            forms: [
                { name: 'tesseract', displayName: 'Tesserakt' }, 
                { name: 'klein_bottle', displayName: 'Kleinflaska' }, 
                { name: 'mobius_strip', displayName: 'M√∂biusband' }, 
                { name: 'hopf_fibration', displayName: 'Hopf-fibrering' }, 
                { name: 'calabi_yau', displayName: 'Calabi-Yau-rum' }
            ], 
            currentIndex: 0 
        },
        ekosystem: { 
            material: 'nebula',
            forms: [
                { name: 'galaxy_spiral', displayName: 'Galaxspiral' }, 
                { name: 'galactic_arm', displayName: 'Galaktisk Arm' }, 
                { name: 'cosmic_web', displayName: 'Kosmiskt N√§t' }, 
                { name: 'supernova_remnant', displayName: 'Supernova-rest' }, 
                { name: 'accretion_disk', displayName: 'Ackretionsskiva' }, 
                { name: 'stellated_dodecahedron', displayName: 'Stj√§rndodekaeder' }, 
                { name: 'merkaba', displayName: 'Merkaba' }, 
                { name: 'atomic_orbitals', displayName: 'Atomorbitaler' }, 
                { name: 'fibonacci_sphere', displayName: 'Fibonacci-sf√§r' }, 
                { name: 'fibonacci_spiral', displayName: 'Fibonaccispiral' },
                { name: 'tetrahedron_grid_64', displayName: 'Vakuumgeometri' }, 
                { name: 'nebula_cloud', displayName: 'Nebulosa' }
            ], 
            currentIndex: 0 
        }
    };

    // --- ANTI-FRAGILE CORE ---
    function logToExternalService(error, context) {
        // I en verklig applikation skulle detta skicka data till en tj√§nst som Sentry, LogRocket, etc.
        console.warn(`[EXTERNAL LOG] Disharmoni observerad i ${context}:`, error);
    }

    // --- CORE PAGE ROUTING LOGIC ---
    document.addEventListener('DOMContentLoaded', () => {
        // KALIBRERING: Neutralisera webbl√§sarens scroll-√•terst√§llning f√∂r att s√§kerst√§lla harmonisk start.
        if ('scrollRestoration' in history) {
            history.scrollRestoration = 'manual';
        }
        window.scrollTo(0, 0);

        const pageConfig = {
            'hero': { isMultiPart: true, parts: ['hero', 'home-diagram-section', 'atom-gallery-section', 'home-contact-section'], display: 'flex', hasFooter: true, navAlias: 'hero' },
            'om-oss': { display: 'flex', hasFooter: true, navAlias: 'om-oss' },
            'system': { display: 'flex', hasFooter: true, navAlias: 'system' },
            'ritbordet': { display: 'flex', hasFooter: true, navAlias: 'ritbordet' },
            'karriar': { display: 'flex', hasFooter: false, navAlias: 'karriar' },
            'vilka-ar-vi': { display: 'flex', hasFooter: false, navAlias: 'karriar' },
            'boka-samtal-skraddarsydd': { display: 'flex', hasFooter: true, navAlias: 'system' },
            'privacy-policy-en': { display: 'flex', hasFooter: true, navAlias: 'hero' },
            'terms-of-service-en': { display: 'flex', hasFooter: true, navAlias: 'hero' },
        };

        window.nord.showPage = function(pageId, isPoppingState = false) {
            const config = pageConfig[pageId];
            if (!config) return;
            
            // Harmoni-fix: S√§kerst√§ll att verkstaden och dess kontroller st√§ngs n√§r man navigerar bort.
            if (pageId !== 'ritbordet' && document.body.classList.contains('labb-active')) {
                if (window.UnifiedGeometryManager) {
                    window.UnifiedGeometryManager.exitBuilderMode();
                }
            } else if (pageId === 'ritbordet') {
                // Harmoni-fix: Tvinga systemet att √•terst√§lla till lobbyn om den redan √§r i verkstadsl√§ge.
                if (document.body.classList.contains('labb-active') && window.UnifiedGeometryManager) {
                    window.UnifiedGeometryManager.exitBuilderMode();
                }
            }

            document.body.classList.toggle('ritbordet-visible', pageId === 'ritbordet');

            const targetState = pageId === 'ritbordet' ? 'WORKSHOP' : (pageId === 'hero' ? 'HERO' : 'PAGE');
            
            const main = document.querySelector('main');
            gsap.to(main, { opacity: 0, duration: 0.4, ease: 'power2.in', onComplete: () => {
                document.querySelectorAll('main > section').forEach(s => s.style.display = 'none');
                const footer = document.getElementById('main-footer');
                if (footer) footer.style.display = config.hasFooter ? 'block' : 'none';
                
                if (config.isMultiPart) {
                    config.parts.forEach(partId => document.getElementById(partId)?.style.setProperty('display', config.display, 'important'));
                } else {
                    document.getElementById(pageId)?.style.setProperty('display', config.display, 'important');
                }

                if (config.initFn) config.initFn();
                window.nord.updateActiveLink(config.navAlias || pageId);
                
                // KALIBRERING: S√§kerst√§ll att vyn √§r vid toppen vid sidbyte, f√∂rutom vid √•terg√•ng fr√•n ritbordet.
                if (window.UnifiedGeometryManager && window.UnifiedGeometryManager.lastState !== 'WORKSHOP') {
                    window.scrollTo({ top: 0, left: 0, behavior: 'instant' });
                }

                requestAnimationFrame(() => {
                    gsap.to(main, { opacity: 1, duration: 0.6, ease: 'power2.out' });
                });
            }});
            
            if (window.UnifiedGeometryManager && !window.UnifiedGeometryManager.initializationFailed) {
                window.UnifiedGeometryManager.transitionTo(targetState);
            }
            
            window.nord.closeMobileMenu();
        };

        // Harmoni-fix: En dedikerad, GSAP-driven funktion f√∂r all mjuk scrollning p√• sidan.
        window.nord.smoothScrollTo = function(selector) {
            gsap.to(window, { duration: 1.5, scrollTo: selector, ease: 'power2.inOut' });
        };

        class GlobalStarfield {
            constructor(scene) {
                this.scene = scene;
                this.createStars();
            }
            createStars() {
                const starsGeometry = new THREE.BufferGeometry();
                const starsVertices = [];
                const starsColors = [];
                const color = new THREE.Color();

                for (let i = 0; i < 25000; i++) { // Harmoni-fix: √ñkat antalet stj√§rnor f√∂r ett rikare universum.
                    const x = (Math.random() - 0.5) * 2000;
                    const y = (Math.random() - 0.5) * 2000;
                    const z = (Math.random() - 0.5) * 2000;
                    starsVertices.push(x, y, z);
                    
                    color.setHSL(0.6, 0.9, 0.5 + Math.random() * 0.4);
                    starsColors.push(color.r, color.g, color.b);
                }

                starsGeometry.setAttribute('position', new THREE.Float32BufferAttribute(starsVertices, 3));
                starsGeometry.setAttribute('color', new THREE.Float32BufferAttribute(starsColors, 3));

                const starsMaterial = new THREE.ShaderMaterial({
                    uniforms: {
                        time: { value: 0.0 },
                        opacity: { value: 1.0 }
                    },
                    vertexShader: `
                        varying vec3 vColor;
                        void main() {
                            vColor = color;
                            vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );
                            gl_PointSize = 1.5 * ( 300.0 / -mvPosition.z );
                            gl_Position = projectionMatrix * mvPosition;
                        }
                    `,
                    fragmentShader: `
                        uniform float time;
                        uniform float opacity;
                        varying vec3 vColor;
                        void main() {
                            if (length(gl_PointCoord - vec2(0.5, 0.5)) > 0.475) discard;
                            float twinkle = 0.6 + 0.4 * sin(time * 5.0 + vColor.r * 10.0);
                            gl_FragColor = vec4(vColor * twinkle, opacity);
                        }
                    `,
                    transparent: true,
                    vertexColors: true,
                    blending: THREE.AdditiveBlending,
                    depthWrite: false
                });

                this.stars = new THREE.Points(starsGeometry, starsMaterial);
                this.scene.add(this.stars);
                this.material = starsMaterial;
            }
        }

        class UnifiedGeometryManager {
            constructor() {
                this.isInitialized = false;
                this.initializationFailed = false;
                this.composer = null;
                this.states = {
                HERO: { zoom: 15, y: 0, opacity: 0.4, rotSpeed: 0.1 }, /* Harmoni-fix: Ytterligare √∂kad ljusstyrka f√∂r en ljusare k√§nsla. */
                PAGE: { zoom: 35, y: 10, opacity: 0.4, rotSpeed: 0.05 }, /* Harmoni-fix: Matchar ljusstyrkan p√• Hero-sektionen. */
                WORKSHOP: { zoom: 22, y: 0, opacity: 1.0, rotSpeed: 0.2 },
                HIDDEN: { zoom: 60, y: 0, opacity: 0.0, rotSpeed: 0.02 } // Harmoni-fix: Mjukare, horisontell ing√•ngsanimation.
            };
            this.currentState = 'HIDDEN';
            this.lastState = 'HIDDEN';
            this.targetState = this.states.HIDDEN;
            
            // State Management Refactor
            this.activeThemeKey = 'fundamental';
            this.isParticleModeActive = false;
            this.attractorParams = { a: 10, b: 28, c: 8.0 / 3.0, dt: 0.01 };
            
            this.isMorphing = false;
            this.currentMorphProgress = 0;
            this.isWorkshopBuilderActive = false;
            
            this.morphVelocity = 0;
                this.dampingFactor = 0.94;
                this.forceFactor = 0.0015;
                this.MAX_INPUT_FORCE = 0.035;
                this.onboardingTimeout = null;
                this.activeParticleMorph = { from: null, to: null };
                this.themeSwitchCooldown = 500; // Harmoni-fix: En "andningspaus" f√∂r temav√§xling.
                this.lastThemeSwitchTime = 0;

                this.interaction = {
                    targetRotationX: 0.5, targetRotationY: 0,
                    actualRotationX: 0.5, actualRotationY: 0,
                    targetZoom: this.states.HIDDEN.zoom, actualZoom: this.states.HIDDEN.zoom,
                    targetY: this.states.HIDDEN.y, 
                    actualY: this.states.HIDDEN.y // Harmoni-fix: √Öterst√§ller startanimationen till en ren zoom f√∂r en mer kontrollerad ing√•ng p√• alla enheter.
                };
                
                this.joystick = {
                    left: { active: false, id: null, startX: 0, startY: 0, currentX: 0, currentY: 0 },
                    right: { active: false, id: null, startX: 0, startY: 0, currentX: 0, currentY: 0 },
                    creatorMode: false,
                    rightTapTimeout: null
                };

                this.boundWheelHandler = this.handleWheel.bind(this);
                this.boundJoystickTouchStart = this.handleJoystickTouchStart.bind(this);
                this.boundJoystickTouchMove = this.handleJoystickTouchMove.bind(this);
                this.boundJoystickTouchEnd = this.handleJoystickTouchEnd.bind(this);
                this.boundHideOnboarding = null;
                this.clock = new THREE.Clock();
            }

            setTheme(themeKey) {
                this.activeThemeKey = themeKey;
                if (this.elasticGeometry) {
                    const theme = SACRED_GEOMETRY_LIBRARY[this.activeThemeKey];
                    this.elasticGeometry.setMaterial(theme?.material || 'organic');
                }
            }

            get activeTheme() {
                return this.activeThemeKey || 'cosmic';
            }

            handleResize() {
                this.camera.aspect = window.innerWidth / window.innerHeight;
                this.camera.updateProjectionMatrix();
                this.renderer.setSize(window.innerWidth, window.innerHeight);
                if (this.composer) {
                    this.composer.setSize(window.innerWidth, window.innerHeight);
                }
            }

            init() {
                try {
                    if (this.isInitialized) return;
                    this.initRenderer();
                    
                    this.stars = new GlobalStarfield(this.scene);

                    this.elasticGeometry = new ElasticGeometry(this.renderer);
                    this.scene.add(this.elasticGeometry.mesh);
                    
                    this.setTheme(this.activeTheme);

                    this.setupInteractionListeners();
                    window.addEventListener('resize', () => this.handleResize(), false);

                    this.animate = this.animate.bind(this);
                    this.animate();
                    this.isInitialized = true;
                } catch (error) {
                    this.initializationFailed = true;
                    console.error("Total disharmoni i UnifiedGeometryManager:", error);
                    logToExternalService(error, "UnifiedGeometryManager.init");
                }
            }

            initRenderer() {
                this.canvas = document.createElement('canvas');
                this.canvas.id = 'unified-geometry-canvas';
                document.body.appendChild(this.canvas);
                this.renderer = new THREE.WebGLRenderer({ canvas: this.canvas, alpha: true, antialias: true, powerPreference: 'high-performance' });
                this.scene = new THREE.Scene();
                this.scene.fog = new THREE.FogExp2(0x0c1427, 0.015);
                this.camera = new THREE.PerspectiveCamera(50, window.innerWidth / window.innerHeight, 0.1, 1000);
                
                if (typeof THREE.EffectComposer !== 'undefined' && typeof THREE.UnrealBloomPass !== 'undefined') {
                    this.composer = new THREE.EffectComposer(this.renderer);
                    this.composer.addPass(new THREE.RenderPass(this.scene, this.camera));
                    const bloomPass = new THREE.UnrealBloomPass(new THREE.Vector2(window.innerWidth, window.innerHeight), 1.3, 0.4, 0.8);
                    this.composer.addPass(bloomPass);
                } else {
                    this.composer = null;
                }
                this.handleResize();
            }

            setupInteractionListeners() {
                const isTouchDevice = window.matchMedia('(pointer: coarse)').matches;
                const joystickLeft = document.getElementById('joystick-portal-left');
                const joystickRight = document.getElementById('joystick-portal-right');

                // Harmoni-fix: Separerar logiken f√∂r touch-enheter och desktop f√∂r att s√§kerst√§lla att r√§tt kontroller alltid laddas.
                if (isTouchDevice && joystickLeft && joystickRight) {
                    // Specifika listeners f√∂r mobil (touch)
                    joystickLeft.addEventListener('touchstart', (e) => this.boundJoystickTouchStart(e, 'left'), { passive: false });
                    joystickRight.addEventListener('touchstart', (e) => this.boundJoystickTouchStart(e, 'right'), { passive: false });
                    
                    window.addEventListener('touchmove', this.boundJoystickTouchMove, { passive: false });
                    window.addEventListener('touchend', this.boundJoystickTouchEnd, { passive: false });
                    window.addEventListener('touchcancel', this.boundJoystickTouchEnd, { passive: false });
                } else {
                    // Specifika listeners f√∂r desktop (mus & hjul)
                    window.addEventListener('wheel', this.boundWheelHandler, { passive: false });
                    if (joystickRight) {
                        joystickRight.addEventListener('click', () => {
                         if (document.body.classList.contains('labb-active')) { this.exitBuilderMode(); }
                         else { this.enterBuilderMode(); }
                    });
                }
                }
                
                // Gemensamma listeners f√∂r b√•de mobil och desktop
                document.querySelectorAll('.glass-btn[data-theme]').forEach(btn => {
                    btn.addEventListener('click', () => this.handleThemeClick(btn.dataset.theme));
                });

                document.getElementById('fractal-mode-toggle').addEventListener('click', () => this.handleParticleClick());

                window.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape' && this.isWorkshopBuilderActive) this.exitBuilderMode();
                });

                // Harmoni-fix: Dedikerad logik f√∂r det nya, hopf√§llbara verktygsf√§ltet p√• mobil.
                const toolbarToggle = document.getElementById('toolbar-toggle');
                const body = document.body;

                if (toolbarToggle) {
                    toolbarToggle.addEventListener('click', () => {
                        body.classList.toggle('toolbar-open');
                        const icon = toolbarToggle.querySelector('i');
                        if (body.classList.contains('toolbar-open')) {
                            icon.className = 'ph ph-x';
                            toolbarToggle.title = 'D√∂lj verktyg';
                        } else {
                            icon.className = 'ph ph-list';
                            toolbarToggle.title = 'Visa verktyg';
                        }
                    });
                }
            }

            handleWheel(e) {
                if (!this.isWorkshopBuilderActive) return;
                e.preventDefault();

                // Harmoni-fix: Ny hierarki av interaktion med Shift och Option/Alt.
                if (e.altKey) { // Skulptering (Option p√• Mac)
                    this.elasticGeometry.sculpt(e.deltaY);
                    return;
                }

                if (e.shiftKey) { // Temav√§xling
                    // Harmoni-fix: "Den Stora Resan" √§r nu mer intelligent och behaglig.
                    if (this.isParticleModeActive) return; 
                    const now = Date.now();
                    if (now - this.lastThemeSwitchTime < this.themeSwitchCooldown) return;

                    const themeKeys = Object.keys(SACRED_GEOMETRY_LIBRARY);
                    const currentIndex = themeKeys.indexOf(this.activeThemeKey || 'struktur');
                    let nextIndex;
                    if (e.deltaY > 0) { // Scrolla ner
                        nextIndex = (currentIndex + 1) % themeKeys.length;
                    } else { // Scrolla upp
                        nextIndex = (currentIndex - 1 + themeKeys.length) % themeKeys.length;
                    }
                    this.handleThemeClick(themeKeys[nextIndex]);
                    this.lastThemeSwitchTime = now; // Notera tidpunkten f√∂r v√§xlingen.
                    return;
                }
                
                // Ordinarie interaktion (Dansen)
                if (this.isParticleModeActive && !this.activeThemeKey) {
                    this.attractorParams.b += e.deltaY * 0.01;
                    this.elasticGeometry.regenerateAttractor(this.attractorParams);
                    this.displayFormName({ displayName: `Attraktor [b=${this.attractorParams.b.toFixed(2)}]` });
                    return;
                }

                const rawForce = e.deltaY * this.forceFactor;
                const force = Math.max(-this.MAX_INPUT_FORCE, Math.min(this.MAX_INPUT_FORCE, rawForce));
                this.morphVelocity += force;
                this.isMorphing = true;
            }

            handleJoystickTouchStart(e, side) {
                // Harmoni-fix: e.preventDefault() √§r borttagen h√§rifr√•n f√∂r att till√•ta
                // webbl√§saren att initiera en scroll-gest √§ven om den startar p√• en joystick.
                const touch = e.changedTouches[0];
                this.joystick[side].active = true;
                this.joystick[side].id = touch.identifier;
                this.joystick[side].startX = touch.clientX;
                this.joystick[side].startY = touch.clientY;
                this.joystick[side].currentX = touch.clientX;
                this.joystick[side].currentY = touch.clientY;
                e.currentTarget.classList.add('active');
                e.currentTarget.classList.add('faded');

                if (side === 'right') {
                    clearTimeout(this.joystick.rightTapTimeout);
                    this.joystick.rightTapTimeout = setTimeout(() => {
                        this.joystick.rightTapTimeout = null;
                    }, 200);
                }
            }

            handleJoystickTouchMove(e) {
                // Harmoni-fix: En "skyddsvakt" s√§kerst√§ller att joystick-logiken ENDAST k√∂rs
                // n√§r verkstaden √§r aktiv. Detta frig√∂r scroll-funktionen p√• alla andra sidor.
                if (!this.isWorkshopBuilderActive) return;

                // e.preventDefault() anropas nu endast villkorligt, inuti logiken
                // f√∂r varje aktiv joystick. Detta s√§kerst√§ller att vi bara blockerar scrollning
                // n√§r anv√§ndaren aktivt manipulerar en kontroll, inte annars.
                for (let i = 0; i < e.changedTouches.length; i++) {
                    const touch = e.changedTouches[i];
                    if (touch.identifier === this.joystick.left.id && this.joystick.left.active) {
                        e.preventDefault(); 
                        const deltaX = touch.clientX - this.joystick.left.currentX;
                        const deltaY = touch.clientY - this.joystick.left.currentY;
                        this.interaction.targetRotationY += deltaX * 0.008;
                        this.interaction.targetRotationX -= deltaY * 0.008;
                        this.interaction.targetRotationX = Math.max(-Math.PI / 2, Math.min(Math.PI / 2, this.interaction.targetRotationX));
                        this.joystick.left.currentX = touch.clientX;
                        this.joystick.left.currentY = touch.clientY;
                    } else if (touch.identifier === this.joystick.right.id && this.joystick.right.active) {
                        e.preventDefault();
                        const deltaY = touch.clientY - this.joystick.right.currentY;
                        if (this.isParticleModeActive && !this.activeThemeKey) {
                           // Harmoni-fix: √Öterst√§ller den stabila, direkta interaktionen f√∂r Attraktorn.
                           this.attractorParams.b -= deltaY * 0.05;
                           this.elasticGeometry.regenerateAttractor(this.attractorParams);
                           this.displayFormName({ displayName: `Attraktor [b=${this.attractorParams.b.toFixed(2)}]` });
                        } else if (this.activeThemeKey) {
                            const rawForce = deltaY * this.forceFactor * 2;
                            const force = Math.max(-this.MAX_INPUT_FORCE, Math.min(this.MAX_INPUT_FORCE, rawForce));
                            this.morphVelocity -= force;
                            this.isMorphing = true;
                        }
                        this.joystick.right.currentX = touch.clientX;
                        this.joystick.right.currentY = touch.clientY;
                    }
                }
            }
            
            handleJoystickTouchEnd(e) {
                for (let i = 0; i < e.changedTouches.length; i++) {
                    const touch = e.changedTouches[i];
                    if (touch.identifier === this.joystick.left.id) {
                        this.joystick.left.active = false;
                        const joyLeft = document.getElementById('joystick-portal-left');
                        joyLeft.classList.remove('active');
                        joyLeft.classList.remove('faded');
                    } else if (touch.identifier === this.joystick.right.id) {
                        if (this.joystick.rightTapTimeout) {
                            clearTimeout(this.joystick.rightTapTimeout);
                            if (document.body.classList.contains('labb-active')) this.exitBuilderMode();
                            else this.enterBuilderMode();
                        }
                        this.joystick.right.active = false;
                        const joyRight = document.getElementById('joystick-portal-right');
                        joyRight.classList.remove('active');
                        joyRight.classList.remove('faded');
                    }
                }
            }
            
            transitionTo(targetStateKey) {
                const baseState = this.states[targetStateKey];
                if (!baseState) return;
                this.lastState = this.currentState;
                this.currentState = targetStateKey;
                
                let finalState = { ...baseState }; 
                if (window.innerWidth < 768) {
                    if (targetStateKey === 'PAGE') {
                        finalState.zoom = 60; 
                    } else if (targetStateKey === 'HERO') {
                        finalState.zoom = 25; // Harmoni-fix: Finjusterad zoom f√∂r mobil.
                        finalState.y = -4; // Harmoni-fix: En subtil s√§nkning f√∂r att √•terskapa desktop-k√§nslan.
                    }
                }
                
                this.targetState = finalState;
                gsap.to(this.interaction, { targetZoom: finalState.zoom, targetY: finalState.y, duration: 2.5, ease: 'power3.inOut' });
                const mat = this.elasticGeometry.mesh.material;
                const uniforms = mat.uniforms;
                gsap.to(uniforms?.opacity || mat, { value: finalState.opacity, duration: 1.5, ease: 'power2.inOut' });
                const starMat = this.stars.material.uniforms.opacity;
                gsap.to(starMat, { value: finalState.opacity > 0 ? 1 : 0, duration: 1.5, ease: 'power2.inOut' });
            }

            handleThemeClick(themeKey) {
                if (this.activeThemeKey === themeKey) {
                    this.activeThemeKey = null; // Deselect
                } else {
                    this.activeThemeKey = themeKey;
                }
                this.updateViewState();
            }
            
            handleParticleClick() {
                this.isParticleModeActive = !this.isParticleModeActive;
                this.updateViewState();
            }
            
            updateViewState() {
                // Update button UI
                document.querySelectorAll('.glass-btn[data-theme]').forEach(btn => {
                    btn.classList.toggle('active', btn.dataset.theme === this.activeThemeKey);
                });
                const fractalBtn = document.getElementById('fractal-mode-toggle');
                fractalBtn.classList.toggle('active', this.isParticleModeActive);
                fractalBtn.classList.toggle('glow', this.isParticleModeActive && !!this.activeThemeKey);

                // Update geometry
                this.elasticGeometry.setParticleMode(this.isParticleModeActive, this.activeThemeKey);
                this.isMorphing = false;
                this.currentMorphProgress = 0;
                this.morphVelocity = 0;

                if (this.isParticleModeActive || (SACRED_GEOMETRY_LIBRARY[this.activeThemeKey]?.material === 'nebula')) {
                    if (this.activeThemeKey) {
                        const theme = SACRED_GEOMETRY_LIBRARY[this.activeThemeKey];
                        theme.currentIndex = 0; // Reset index on select
                        this.activeShape = theme.forms[theme.currentIndex];
                        this.elasticGeometry.morphToShape(this.activeShape.name);
                        this.displayFormName(this.activeShape);
                    } else {
                        // Pure fractal mode: Ursprunglig Attraktor
                        this.activeShape = { name: 'lorenz_attractor', displayName: 'Ursprunglig Attraktor' };
                        this.elasticGeometry.morphToShape(this.activeShape.name);
                        this.displayFormName(this.activeShape);
                    }
                } else {
                    if (this.activeThemeKey) {
                        const theme = SACRED_GEOMETRY_LIBRARY[this.activeThemeKey];
                        theme.currentIndex = 0; // Reset index on select
                        this.activeShape = theme.forms[theme.currentIndex];
                        this.elasticGeometry.morphToShape(this.activeShape.name);
                        this.displayFormName(this.activeShape);
                    } else {
                        // No theme, no fractal -> Fade out
                        gsap.to(this.elasticGeometry.mesh.material.uniforms?.opacity || this.elasticGeometry.mesh.material, { value: 0.1, duration: 0.5 });
                        this.hideFormName();
                    }
                }
            }

            enterBuilderMode() {
                this.isWorkshopBuilderActive = true;
                document.body.classList.add('labb-active');
                this.transitionTo('WORKSHOP');
                
                const onboardingEl = document.getElementById('workshop-onboarding');
                onboardingEl?.classList.add('visible');
                
                clearTimeout(this.onboardingTimeout);
                this.onboardingTimeout = setTimeout(() => this.hideOnboarding(), 4000);

                // Harmoni-fix: L√•t anv√§ndaren klicka bort rutan.
                if (onboardingEl && !this.boundHideOnboarding) {
                    this.boundHideOnboarding = this.hideOnboarding.bind(this);
                    onboardingEl.addEventListener('click', this.boundHideOnboarding);
                }

                // Harmoni-fix: Aktivera bara de globala touch-lyssnarna n√§r verkstaden √§r aktiv.
                if (window.matchMedia('(pointer: coarse)').matches) {
                    window.addEventListener('touchmove', this.boundJoystickTouchMove, { passive: false });
                    window.addEventListener('touchend', this.boundJoystickTouchEnd, { passive: false });
                    window.addEventListener('touchcancel', this.boundJoystickTouchEnd, { passive: false });
                }

                // Set initial state for workshop
                this.updateViewState();
            }
            
            exitBuilderMode() {
                clearTimeout(this.onboardingTimeout);
                this.isWorkshopBuilderActive = false;
                document.body.classList.remove('labb-active');
                document.body.classList.remove('toolbar-open'); // Harmoni-fix: S√§kerst√§ll att verktygsf√§ltet st√§ngs.
                this.transitionTo(this.lastState === 'HIDDEN' ? 'HERO' : this.lastState);
                this.hideOnboarding();
                this.hideFormName();
                
                // Harmoni-fix: Utrotar scroll-konflikten genom att garanterat ta bort de globala lyssnarna.
                // Tidigare anrop hade fel syntax, vilket gjorde att de aldrig togs bort.
                if (window.matchMedia('(pointer: coarse)').matches) {
                    window.removeEventListener('touchmove', this.boundJoystickTouchMove);
                    window.removeEventListener('touchend', this.boundJoystickTouchEnd);
                    window.removeEventListener('touchcancel', this.boundJoystickTouchEnd);
                }
            }
            
            hideOnboarding() { 
                const onboardingEl = document.getElementById('workshop-onboarding');
                if(onboardingEl) {
                    onboardingEl.classList.remove('visible'); 
                    // Harmoni-fix: Rensa event listener f√∂r att f√∂rhindra minnesl√§ckor.
                    if (this.boundHideOnboarding) {
                        onboardingEl.removeEventListener('click', this.boundHideOnboarding);
                        this.boundHideOnboarding = null;
                    }
                }
            }
            
            displayFormName(shape) {
                if (!this.isWorkshopBuilderActive || !shape) return;
                const el = document.getElementById('form-name-display'); if (!el) return;
                const name = shape.displayName || shape.name.replace(/_/g, ' ');
                el.textContent = name; 
                el.classList.add('visible');
            }
            
            hideFormName() { document.getElementById('form-name-display')?.classList.remove('visible'); }

            animate() {
                requestAnimationFrame(this.animate);
                const time = this.clock.getElapsedTime();
                
                this.interaction.actualRotationX += (this.interaction.targetRotationX - this.interaction.actualRotationX) * 0.1;
                this.interaction.actualRotationY += (this.interaction.targetRotationY - this.interaction.actualRotationY) * 0.1;
                this.interaction.actualZoom += (this.interaction.targetZoom - this.interaction.actualZoom) * 0.05;
                this.interaction.actualY += (this.interaction.targetY - this.interaction.actualY) * 0.05;
                
                if (this.isWorkshopBuilderActive && this.activeThemeKey) {
                    this.currentMorphProgress += this.morphVelocity; this.morphVelocity *= this.dampingFactor;
                    if (Math.abs(this.morphVelocity) < 0.0001) { this.morphVelocity = 0; if(this.isMorphing) this.isMorphing = false; }
                    const theme = SACRED_GEOMETRY_LIBRARY[this.activeThemeKey];
                    if (this.currentMorphProgress >= 1) { theme.currentIndex = (theme.currentIndex + 1) % theme.forms.length; this.activeShape = theme.forms[theme.currentIndex]; this.currentMorphProgress -= 1.0; if ('vibrate' in navigator) navigator.vibrate(30); } 
                    else if (this.currentMorphProgress < 0) { theme.currentIndex = (theme.currentIndex - 1 + theme.forms.length) % theme.forms.length; this.activeShape = theme.forms[theme.currentIndex]; this.currentMorphProgress += 1.0; if ('vibrate' in navigator) navigator.vibrate(30); }
                    const fromShape = theme.forms[theme.currentIndex], toShape = theme.forms[(theme.currentIndex + 1) % theme.forms.length];
                    
                    // Harmoni-fix: Optimerad animationslogik f√∂r partiklar.
                    if (this.elasticGeometry.isParticleSystem) {
                        // Om formen vi morfar mellan har √§ndrats, uppdaterar vi geometri-buffrarna en enda g√•ng.
                        if (this.activeParticleMorph.from !== fromShape.name || this.activeParticleMorph.to !== toShape.name) {
                            this.elasticGeometry.setMorph(fromShape.name, toShape.name, this.currentMorphProgress);
                            this.activeParticleMorph.from = fromShape.name;
                            this.activeParticleMorph.to = toShape.name;
                        }
                        // I varje frame uppdaterar vi endast progress-v√§rdet i grafikprocessorn, vilket ger en helt mjuk animation.
                        this.elasticGeometry.mesh.material.uniforms.morphProgress.value = this.currentMorphProgress;
                    } else {
                        // Solida geometrier anv√§nder en annan fysikbaserad morfning.
                        this.elasticGeometry.setMorph(fromShape.name, toShape.name, this.currentMorphProgress);
                    }
                    
                    const fromName = fromShape.displayName || fromShape.name.replace(/_/g, ' ');
                    const toName = toShape.displayName || toShape.name.replace(/_/g, ' ');

                    this.displayFormName(this.isMorphing ? { displayName: `${fromName} ‚Üí ${toName}` } : this.activeShape);
                }
                
                const cameraX = Math.sin(this.interaction.actualRotationY) * Math.cos(this.interaction.actualRotationX) * this.interaction.actualZoom;
                const cameraZ = Math.cos(this.interaction.actualRotationY) * Math.cos(this.interaction.actualRotationX) * this.interaction.actualZoom;
                const cameraY = Math.sin(this.interaction.actualRotationX) * this.interaction.actualZoom + this.interaction.actualY;

                this.camera.position.set(cameraX, cameraY, cameraZ);
                this.camera.lookAt(0, this.interaction.actualY, 0);
                
                this.stars.material.uniforms.time.value = time;
                this.elasticGeometry.update(time);
                
                if (this.composer) {
                    this.composer.render();
                } else {
                    this.renderer.render(this.scene, this.camera);
                }
            }
        }

        class ElasticGeometry {
            constructor(renderer) {
                this.renderer = renderer; this.SPRING_STRENGTH = 0.04; this.DAMPING = 0.88; this.velocityThreshold = 0.0001; this.isParticleSystem = false; this.activeMorph = null;
               this.initGeometry(); this.initPhysics(); this.initMaterials(); this.initVisuals();
            }

            _addColorAttribute(geometry) {
                if (geometry.attributes.color) return;
                const count = geometry.attributes.position.count;
                const colors = new Float32Array(count * 3);
                const life = new Float32Array(count); // Harmoni-fix: Partiklarna f√•r ett individuellt liv.
                const color1 = new THREE.Color(0x00D4FF); // NordSym Cyan
                const color2 = new THREE.Color(0x9370DB); // NordSym Purple
                const tempColor = new THREE.Color();
                for (let i = 0; i < count; i++) {
                    tempColor.copy(color1).lerp(color2, Math.random());
                    colors[i * 3] = tempColor.r;
                    colors[i * 3 + 1] = tempColor.g;
                    colors[i * 3 + 2] = tempColor.b;
                    life[i] = Math.random() * 10.0; // Ett unikt startv√§rde f√∂r varje partikel.
                }
                geometry.setAttribute('color', new THREE.BufferAttribute(colors, 3));
                geometry.setAttribute('life', new THREE.BufferAttribute(life, 1));
            }

            initGeometry() {
                this.geometries = {
                    tetrahedron: new THREE.TetrahedronGeometry(5, 1), cube: new THREE.BoxGeometry(7, 7, 7),
                    octahedron: new THREE.OctahedronGeometry(5, 1), dodecahedron: new THREE.DodecahedronGeometry(5, 1),
                    icosahedron: new THREE.IcosahedronGeometry(5, 2), seed_of_life: new THREE.SphereGeometry(4.5, 64, 64),
                    flower_of_life: new THREE.TorusGeometry(4, 1.5, 8, 50), metatrons_cube: new THREE.IcosahedronGeometry(5, 1),
                    torus: new THREE.TorusGeometry(4, 1.5, 16, 100), trinity_knot: new THREE.TorusKnotGeometry(3.5, 0.8, 128, 16, 2, 3),
                    diamond_brilliant: new THREE.OctahedronGeometry(5, 0), quartz_point: new THREE.CylinderGeometry(0, 3, 8, 6),
                    bismuth_spiral: new THREE.BoxGeometry(6,6,6), geode: new THREE.SphereGeometry(4.5, 32, 32),
                    prism_triangular: new THREE.CylinderGeometry(4, 4, 6, 3), tesseract: new THREE.BoxGeometry(7, 7, 7),
                    klein_bottle: new THREE.TorusKnotGeometry(3.5, 1, 64, 8, 1, 3), mobius_strip: new THREE.TorusGeometry(4, 0.5, 8, 50),
                    hopf_fibration: new THREE.TorusKnotGeometry(3.5, 0.8, 128, 16, 2, 3), calabi_yau: new THREE.TorusKnotGeometry(3.5, 1.2, 128, 16, 3, 7),
                    fibonacci_spiral: new THREE.TorusGeometry(4, 0.2, 16, 100), galaxy_spiral: new THREE.SphereGeometry(5, 64, 64),
                    merkaba: new THREE.TetrahedronGeometry(5, 0), tetrahedron_grid_64: new THREE.IcosahedronGeometry(5, 2),
                    nebula_cloud: new THREE.SphereGeometry(5, 64, 64), 
                    fractal_fibonacci: this.createFractalGeometry(),
                    fibonacci_sphere: this.createFibonacciSphereGeometry(),
                    galactic_arm: this.createGalacticArmGeometry(),
                    accretion_disk: this.createAccretionDiskGeometry(),
                    cosmic_web: this.createCosmicWebGeometry(),
                    stellated_dodecahedron: this.createStellatedDodecahedronGeometry(),
                    atomic_orbitals: this.createAtomicOrbitalsGeometry(),
                    supernova_remnant: this.createSupernovaRemnantGeometry(),
                    lorenz_attractor: this.createLorenzAttractorGeometry(),
                     // Formerna f√∂r det nya "Grundl√§ggande" temat
                    potential: this.createPotentialGeometry(),
                    relation: this.createRelationGeometry(),
                    structure: this.createStructureGeometry(),
                    adaptation: this.createAdaptationGeometry(),
                    synergy: this.createSynergyGeometry()
                };
                
                Object.values(this.geometries).forEach(geo => this._addColorAttribute(geo));

                this.geometry = this.geometries.seed_of_life.clone(); this.geometry.computeVertexNormals();
            }
            createFractalGeometry(count = 10000) {
                const points = []; let x = 0.1, y = 0, z = 0; const a = 10, b = 28, c = 8.0 / 3.0; const dt = 0.01;
                for (let i = 0; i < count; i++) { const dx = a * (y - x) * dt; const dy = (x * (b - z) - y) * dt; const dz = (x * y - c * z) * dt; x += dx; y += dy; z += dz; if (i > 100) points.push(x * 0.2, y * 0.2, z * 0.2); }
                const geometry = new THREE.BufferGeometry(); geometry.setAttribute('position', new THREE.Float32BufferAttribute(points, 3)); return geometry;
            }
             createPotentialGeometry(count = 2000, radius = 5) { // Harmoni-fix: Minskat antalet punkter f√∂r en klarare, mer "potentiell" k√§nsla.
                const points = []; 
                for (let i = 0; i < count; i++) { 
                    const u = Math.random();
                    const v = Math.random();
                    const theta = 2 * Math.PI * u;
                    const phi = Math.acos(2 * v - 1);
                    const r = radius * Math.cbrt(Math.random());
                    const x = r * Math.sin(phi) * Math.cos(theta);
                    const y = r * Math.sin(phi) * Math.sin(theta);
                    const z = r * Math.cos(phi);
                    points.push(x, y, z); 
                }
                const geometry = new THREE.BufferGeometry(); 
                geometry.setAttribute('position', new THREE.Float32BufferAttribute(points, 3)); 
                return geometry;
            }
            createRelationGeometry(nodes = 50, connectionsPerNode = 1, radius = 8) { // Harmoni-fix: Minskat antalet kopplingar f√∂r en tydligare, mindre trasslig struktur.
                const geometry = new THREE.BufferGeometry();
                const nodePoints = [];
                for(let i = 0; i < nodes; i++) { 
                    nodePoints.push(new THREE.Vector3((Math.random() - 0.5) * radius * 2, (Math.random() - 0.5) * radius * 2, (Math.random() - 0.5) * radius * 2)); 
                }
                const vertices = [];
                const connected = new Set();
                nodePoints.forEach((p1, i) => {
                    const distances = nodePoints.map((p2, j) => ({ index: j, dist: p1.distanceTo(p2) }))
                        .sort((a, b) => a.dist - b.dist)
                        .slice(1, connectionsPerNode + 1);

                    distances.forEach(d => {
                        const j = d.index;
                        const key1 = `${i}-${j}`, key2 = `${j}-${i}`;
                        if (!connected.has(key1) && !connected.has(key2)) {
                            const p2 = nodePoints[j];
                            vertices.push(p1.x, p1.y, p1.z);
                            vertices.push(p2.x, p2.y, p2.z);
                            connected.add(key1);
                        }
                    });
                });

                geometry.setAttribute('position', new THREE.Float32BufferAttribute(vertices, 3));
                return geometry;
            }
            createStructureGeometry(size = 8, divisions = 5) {
                const geometry = new THREE.BufferGeometry();
                const vertices = [];
                const step = size / divisions;
                const halfSize = size / 2;

                for (let i = 0; i <= divisions; i++) {
                    const x = -halfSize + i * step;
                    const y = -halfSize + i * step;
                    const z = -halfSize + i * step;

                    // Lines along X
                    vertices.push(-halfSize, y, z, halfSize, y, z);
                    // Lines along Y
                    vertices.push(x, -halfSize, z, x, halfSize, z);
                    // Lines along Z
                    vertices.push(x, y, -halfSize, x, y, halfSize);
                }

                geometry.setAttribute('position', new THREE.Float32BufferAttribute(vertices, 3));
                return geometry;
            }
            createAdaptationGeometry(size = 8, divisions = 5) { // Harmoni-fix: Minskat antalet "tr√•dar" f√∂r en luftigare, mer genomskinlig k√§nsla.
                 const geometry = new THREE.PlaneGeometry(size, size, divisions, divisions);
                 // Deform it into a sphere-like shape
                 const vertices = geometry.attributes.position;
                 for (let i = 0; i < vertices.count; i++) {
                     const vertex = new THREE.Vector3().fromBufferAttribute(vertices, i);
                     vertex.normalize().multiplyScalar(size / 2);
                     vertices.setXYZ(i, vertex.x, vertex.y, vertex.z);
                 }
                 geometry.computeVertexNormals();
                 return geometry;
            }
            createSynergyGeometry(radius = 5, detail = 5) {
                return new THREE.IcosahedronGeometry(radius, detail);
            }
            createLorenzAttractorGeometry(params = { a: 10, b: 28, c: 8.0 / 3.0, dt: 0.01 }, count = 15000) {
                const points = [];
                let x = 0.1, y = 0, z = 0;
                const { a, b, c, dt } = params;
                for (let i = 0; i < count; i++) {
                    const dx = a * (y - x) * dt;
                    const dy = (x * (b - z) - y) * dt;
                    const dz = (x * y - c * z) * dt;
                    x += dx; y += dy; z += dz;
                    if (i > 100) points.push(x * 0.3, y * 0.3, (z * 0.3) - 10);
                }
                const geometry = new THREE.BufferGeometry();
                geometry.setAttribute('position', new THREE.Float32BufferAttribute(points, 3));
                return geometry;
            }
            regenerateAttractor(params) {
                const newGeo = this.createLorenzAttractorGeometry(params);
                this.geometries['lorenz_attractor'] = newGeo;
                this._addColorAttribute(newGeo);
                // Harmoni-fix: √Öterg√•r till den direkta, stabila metoden f√∂r att uppdatera Attraktorn.
                this.morphToShape('lorenz_attractor');
            }
            createFibonacciSphereGeometry(count = 2000, radius = 5) {
                const points = []; const phi = Math.PI * (3. - Math.sqrt(5.)); 
                for (let i = 0; i < count; i++) { const y = 1 - (i / (count - 1)) * 2; const r = Math.sqrt(1 - y * y); const theta = phi * i; const x = Math.cos(theta) * r; const z = Math.sin(theta) * r; points.push(x * radius, y * radius, z * radius); }
                const geometry = new THREE.BufferGeometry(); geometry.setAttribute('position', new THREE.Float32BufferAttribute(points, 3)); return geometry;
            }
            createGalacticArmGeometry(count = 3000, radius = 6) {
                const points = []; const armCount = 2; const spread = 1.5;
                for (let i = 0; i < count; i++) {
                    const r = Math.sqrt(Math.random()) * radius;
                    const angle = Math.random() * 2 * Math.PI + (r / radius) * 5;
                    const arm = Math.floor(Math.random() * armCount);
                    const armAngle = (2 * Math.PI / armCount) * arm;
                    const x = Math.cos(angle + armAngle) * r + (Math.random() - 0.5) * spread;
                    const y = (Math.random() - 0.5) * (spread / 2) * (1 - r / radius);
                    const z = Math.sin(angle + armAngle) * r + (Math.random() - 0.5) * spread;
                    points.push(x, y, z);
                }
                const geometry = new THREE.BufferGeometry(); geometry.setAttribute('position', new THREE.Float32BufferAttribute(points, 3)); return geometry;
            }
            createAccretionDiskGeometry(count = 15000) {
                const points = [];
                for (let i = 0; i < count; i++) {
                    const r = Math.pow(Math.random(), 2) * 8;
                    const angle = Math.random() * Math.PI * 10;
                    const x = Math.cos(angle) * r;
                    const z = Math.sin(angle) * r;
                    const y = (Math.random() - 0.5) * 0.2 * (1 - r/8);
                    points.push(x, y, z);
                }
                const geometry = new THREE.BufferGeometry(); geometry.setAttribute('position', new THREE.Float32BufferAttribute(points, 3)); return geometry;
            }
            createCosmicWebGeometry(count = 15000) {
                const points = [];
                const nodes = [];
                for(let i = 0; i < 20; i++) { nodes.push(new THREE.Vector3((Math.random() - 0.5) * 30, (Math.random() - 0.5) * 30, (Math.random() - 0.5) * 30)); }
                for (let i = 0; i < count; i++) {
                    const p1 = nodes[Math.floor(Math.random() * nodes.length)];
                    const p2 = nodes[Math.floor(Math.random() * nodes.length)];
                    const point = new THREE.Vector3().lerpVectors(p1, p2, Math.random());
                    point.x += (Math.random() - 0.5) * 0.5;
                    point.y += (Math.random() - 0.5) * 0.5;
                    point.z += (Math.random() - 0.5) * 0.5;
                    points.push(point.x, point.y, point.z);
                }
                const geometry = new THREE.BufferGeometry(); geometry.setAttribute('position', new THREE.Float32BufferAttribute(points, 3)); return geometry;
            }
            createStellatedDodecahedronGeometry() {
                const baseGeo = new THREE.DodecahedronGeometry(5, 0);
                const vertices = [];
                const basePositions = baseGeo.attributes.position;
                for (let i = 0; i < basePositions.count; i += 3) {
                    const v1 = new THREE.Vector3().fromBufferAttribute(basePositions, i);
                    const v2 = new THREE.Vector3().fromBufferAttribute(basePositions, i + 1);
                    const v3 = new THREE.Vector3().fromBufferAttribute(basePositions, i + 2);
                    const center = new THREE.Vector3().add(v1).add(v2).add(v3).divideScalar(3);
                    const stellatedPoint = center.clone().normalize().multiplyScalar(8);
                    vertices.push(v1.x, v1.y, v1.z, v2.x, v2.y, v2.z, stellatedPoint.x, stellatedPoint.y, stellatedPoint.z);
                    vertices.push(v2.x, v2.y, v2.z, v3.x, v3.y, v3.z, stellatedPoint.x, stellatedPoint.y, stellatedPoint.z);
                    vertices.push(v3.x, v3.y, v3.z, v1.x, v1.y, v1.z, stellatedPoint.x, stellatedPoint.y, stellatedPoint.z);
                }
                const geometry = new THREE.BufferGeometry(); geometry.setAttribute('position', new THREE.Float32BufferAttribute(vertices, 3)); return geometry;
            }
            createAtomicOrbitalsGeometry(count = 15000) {
                const points = [];
                const radii = [3, 6, 9];
                for (let i = 0; i < count; i++) {
                    const r = radii[Math.floor(Math.random() * radii.length)];
                    const u = Math.random();
                    const v = Math.random();
                    const theta = 2 * Math.PI * u;
                    const phi = Math.acos(2 * v - 1);
                    const x = r * Math.sin(phi) * Math.cos(theta);
                    const y = r * Math.sin(phi) * Math.sin(theta);
                    const z = r * Math.cos(phi);
                    points.push(x, y, z);
                }
                const geometry = new THREE.BufferGeometry();
                geometry.setAttribute('position', new THREE.Float32BufferAttribute(points, 3));
                return geometry;
            }
            createSupernovaRemnantGeometry(count = 20000, radius = 10) {
                const points = [];
                for (let i = 0; i < count; i++) {
                    const u = Math.random();
                    const v = Math.random();
                    const r = radius * Math.sqrt(u);
                    const theta = 2 * Math.PI * v;
                    const shell_thickness = 0.5 * Math.random();
                    const R = r * (1.0 - shell_thickness * shell_thickness);

                    const phi = Math.acos(2 * Math.random() - 1);
                    const x = R * Math.sin(phi) * Math.cos(theta);
                    const y = R * Math.sin(phi) * Math.sin(theta);
                    const z = R * Math.cos(phi);
                    points.push(x, y, z);
                }
                const geometry = new THREE.BufferGeometry();
                geometry.setAttribute('position', new THREE.Float32BufferAttribute(points, 3));
                return geometry;
            }
            initMaterials() {
                const nebulaShader = {
                    uniforms: { time: { value: 0 }, rotation: { value: 0}, opacity: { value: 1.0 }, pointSize: { value: 2.5 }, morphProgress: { value: 0.0 }, pulseIntensity: { value: 1.0 } },
                    vertexShader: `attribute vec3 color; attribute float life; attribute vec3 morphTarget; uniform float time; uniform float rotation; uniform float pointSize; uniform float morphProgress; varying vec3 vColor; varying float vLife; void main() { vColor = color; vLife = life; vec3 p = mix(position, morphTarget, morphProgress); mat2 rot = mat2(cos(rotation), -sin(rotation), sin(rotation), cos(rotation)); p.xz = rot * p.xz; vec4 mvPosition = modelViewMatrix * vec4(p, 1.0); gl_PointSize = pointSize * (20.0 / -mvPosition.z); gl_Position = projectionMatrix * mvPosition; }`,
                    fragmentShader: `uniform float time; uniform float opacity; uniform float pulseIntensity; varying vec3 vColor; varying float vLife; void main() { float dist = length(gl_PointCoord - vec2(0.5)); if (dist > 0.45) discard; float pulse = 0.8 + 0.2 * sin(time * 3.0 + vLife); gl_FragColor = vec4(vColor * pulse * pulseIntensity, smoothstep(0.45, 0.1, dist) * opacity); }`,
                    transparent: true, blending: THREE.AdditiveBlending, depthWrite: false
                };
                this.materials = {
                    neural: new THREE.ShaderMaterial({ uniforms: { time: { value: 0 }, rotation: { value: 0 }, opacity: { value: 1.0 }, thickness: { value: 0.1 } }, vertexShader: `uniform float rotation; void main() { vec3 p = position; mat2 rot = mat2(cos(rotation), -sin(rotation), sin(rotation), cos(rotation)); p.xz = rot * p.xz; gl_Position = projectionMatrix * modelViewMatrix * vec4(p, 1.0); }`, fragmentShader: `uniform float opacity; uniform float thickness; void main() { gl_FragColor = vec4(0.0, 0.83, 1.0, 0.5 * opacity); }`, wireframe: true, transparent: true }),
                    organic: new THREE.ShaderMaterial({ uniforms: { time: { value: 0 }, rotation: { value: 0}, opacity: { value: 1.0 }, displacement: { value: 0.0 } }, vertexShader: `uniform float time; uniform float rotation; uniform float displacement; varying vec3 vNormal; void main() { vNormal = normal; float d = sin(position.y * 2.0 + time * 3.0) * displacement + cos(position.x * 2.0 + time * 2.0) * displacement; vec3 newPosition = position + normal * d; mat2 rot = mat2(cos(rotation), -sin(rotation), sin(rotation), cos(rotation)); newPosition.xz = rot * newPosition.xz; gl_Position = projectionMatrix * modelViewMatrix * vec4(newPosition, 1.0); }`, fragmentShader: `varying vec3 vNormal; uniform float opacity; void main() { float intensity = pow(0.7 - dot(vNormal, vec3(0.0, 0.0, 1.0)), 2.0); gl_FragColor = vec4(vec3(0.5, 0.8, 1.0) * intensity, opacity); }`, wireframe: true, transparent: true }),
                    crystal: new THREE.ShaderMaterial({ uniforms: { time: { value: 0 }, rotation: { value: 0}, opacity: { value: 1.0 }, fresnelPower: { value: 2.0 } }, vertexShader: `uniform float rotation; varying vec3 vNormal; varying vec3 vViewPosition; void main() { vNormal = normalize(normalMatrix * normal); vec3 p = position; mat2 rot = mat2(cos(rotation), -sin(rotation), sin(rotation), cos(rotation)); p.xz = rot * p.xz; vec4 mvPosition = modelViewMatrix * vec4(p, 1.0); vViewPosition = -mvPosition.xyz; gl_Position = projectionMatrix * mvPosition; }`, fragmentShader: `uniform float fresnelPower; varying vec3 vNormal; varying vec3 vViewPosition; uniform float opacity; void main() { vec3 viewDir = normalize(vViewPosition); float fresnel = 1.0 - dot(viewDir, vNormal); fresnel = pow(fresnel, fresnelPower); vec3 iceColor = vec3(0.9, 0.95, 1.0); vec3 shadowColor = vec3(0.7, 0.85, 1.0); vec3 color = mix(shadowColor, iceColor, fresnel); float frost = sin(vNormal.y * 10.0) * 0.05 + 0.95; gl_FragColor = vec4(color * frost, (0.9 + fresnel * 0.1) * opacity); }`, transparent: true, side: THREE.DoubleSide }),
                    quantum: new THREE.ShaderMaterial({ uniforms: { time: { value: 0 }, rotation: { value: 0}, opacity: { value: 1.0 }, flickerIntensity: { value: 0.2 } }, vertexShader: `uniform float rotation; varying vec3 vNormal; varying vec3 vViewPosition; void main() { vNormal = normalize(normalMatrix * normal); vec3 p = position; mat2 rot = mat2(cos(rotation), -sin(rotation), sin(rotation), cos(rotation)); p.xz = rot * p.xz; vec4 mvPosition = modelViewMatrix * vec4(p, 1.0); vViewPosition = -mvPosition.xyz; gl_Position = projectionMatrix * mvPosition; }`, fragmentShader: `uniform float time; uniform float flickerIntensity; varying vec3 vNormal; varying vec3 vViewPosition; uniform float opacity; void main() { vec3 viewDir = normalize(vViewPosition); float fresnel = 1.0 - dot(viewDir, vNormal); fresnel = pow(fresnel, 4.0); float flicker = 0.8 + sin(vNormal.x * 10.0 + time * 2.0) * flickerIntensity; vec3 baseColor = vec3(0.1, 0.15, 0.3) * flicker; vec3 rimColor = vec3(0.6, 0.8, 1.0); vec3 color = mix(baseColor, rimColor, fresnel); gl_FragColor = vec4(color, (fresnel * 0.5 + 0.3) * opacity); }`, transparent: true, blending: THREE.AdditiveBlending }),
                    nebula: new THREE.ShaderMaterial(nebulaShader)
                };
            }
            initPhysics() { const vertexCount = this.geometry.attributes.position.count; this.originalPositions = new Float32Array(this.geometry.attributes.position.array); this.velocities = new Array(vertexCount).fill(0).map(() => new THREE.Vector3()); }
            initVisuals() { this.mesh = new THREE.Mesh(this.geometry, this.materials.organic); this.mesh.renderOrder = 0; }
            
            setMaterial(materialKey) {
                const newMat = this.materials[materialKey]; if (!newMat) return;
                const currentOpacity = this.mesh.material.uniforms?.opacity?.value ?? this.mesh.material.opacity;
                if (newMat.uniforms?.opacity) newMat.uniforms.opacity.value = currentOpacity; else newMat.opacity = currentOpacity;
                Object.values(this.materials).forEach(mat => { if(mat.wireframe) mat.wireframe = false; });
                if (newMat.wireframe !== undefined) newMat.wireframe = true;
                
                const isNebulaType = (materialKey === 'nebula');
                const needsMeshTypeChange = (isNebulaType && this.mesh.type !== 'Points') || (!isNebulaType && this.mesh.type !== 'Mesh');

                if (needsMeshTypeChange) {
                    const currentScene = this.mesh.parent;
                    if (currentScene) currentScene.remove(this.mesh);

                    if (isNebulaType) {
                        this.mesh = new THREE.Points(this.geometry, newMat);
                        // Harmoni-fix: Detta √§r den kritiska pusselbiten. N√§r en solid form blir partiklar,
                        // m√•ste den f√• ett 'morphTarget'-attribut s√• att partikel-shadern vet hur den ska kunna
                        // transformera sig i framtiden. Utan detta kraschar shadern och ingenting syns.
                        if (!this.geometry.attributes.morphTarget) {
                            this.geometry.setAttribute('morphTarget', new THREE.BufferAttribute(new Float32Array(this.geometry.attributes.position.array), 3));
                        }
                    } else {
                        this.mesh = new THREE.Mesh(this.geometry, newMat);
                    }
                    
                    if (currentScene) currentScene.add(this.mesh);
                } else {
                    this.mesh.material = newMat;
                }
            }

            update(time) {
                if (this.mesh.material.uniforms && this.mesh.material.uniforms.time) { this.mesh.material.uniforms.time.value = time; }
                if (this.mesh.material.uniforms && this.mesh.material.uniforms.rotation) { this.mesh.material.uniforms.rotation.value = time * 0.1; }
                
                if (this.mesh.type === 'Points') return; // Don't run physics on particle systems
                const positions = this.geometry.attributes.position.array; const restPos = new THREE.Vector3(); const currentPos = new THREE.Vector3();
                for (let i = 0; i < this.velocities.length; i++) {
                    restPos.fromArray(this.originalPositions, i * 3); currentPos.fromArray(positions, i * 3);
                    if (this.velocities[i].lengthSq() < this.velocityThreshold * this.velocityThreshold && currentPos.distanceToSquared(restPos) < 0.001) { this.velocities[i].set(0, 0, 0); currentPos.copy(restPos); } else { const springForce = restPos.clone().sub(currentPos).multiplyScalar(this.SPRING_STRENGTH); this.velocities[i].add(springForce); this.velocities[i].multiplyScalar(this.DAMPING); currentPos.add(this.velocities[i]); }
                    currentPos.toArray(positions, i * 3);
                }
                this.geometry.attributes.position.needsUpdate = true; this.geometry.computeVertexNormals();
            }
            nudge() { 
                if (this.mesh.type === 'Points') { 
                    gsap.to(this.mesh.material.uniforms.pulseIntensity, { value: 2.5, duration: 0.3, yoyo: true, repeat: 1, ease: 'power2.inOut' });
                } else {
                    for (let i = 0; i < this.velocities.length; i++) { this.velocities[i].add(new THREE.Vector3(Math.random()-0.5, Math.random()-0.5, Math.random()-0.5).multiplyScalar(0.1)); }
                }
            }
             sculpt(delta) {
                const material = this.mesh.material;
                if (!material.uniforms) return;

                if (this.isParticleSystem) {
                    const size = material.uniforms.pointSize;
                    if (size) size.value = Math.max(0.5, Math.min(5.0, size.value - delta * 0.01));
                } else {
                    const themeKey = window.UnifiedGeometryManager.activeTheme;
                    switch(themeKey) {
                        case 'organic':
                            const displacement = material.uniforms.displacement;
                            if (displacement) displacement.value = Math.max(0, Math.min(1.0, displacement.value - delta * 0.001));
                            break;
                        case 'crystal':
                             const fresnelPower = material.uniforms.fresnelPower;
                             if (fresnelPower) fresnelPower.value = Math.max(0.1, Math.min(8.0, fresnelPower.value - delta * 0.01));
                            break;
                        case 'quantum':
                            const flicker = material.uniforms.flickerIntensity;
                            if (flicker) flicker.value = Math.max(0, Math.min(1.0, flicker.value - delta * 0.001));
                            break;
                        default:
                            break;
                    }
                }
            }
            morphToShape(shapeKey, scale = 1.0) {
                const targetGeo = this.geometries[shapeKey.toLowerCase()]; if (!targetGeo || !targetGeo.attributes.position) return; if (this.activeMorph) this.activeMorph.kill();
                
                const vertexCount = this.originalPositions.length / 3;
                const targetPositions = new Float32Array(vertexCount * 3);
                const targetColors = new Float32Array(vertexCount * 3);
                const targetLifes = new Float32Array(vertexCount);

                const targetPosAttr = targetGeo.attributes.position;
                const targetColorAttr = targetGeo.attributes.color;
                const targetLifeAttr = targetGeo.attributes.life;

                for (let i = 0; i < vertexCount; i++) { 
                    const targetIndex = i % targetPosAttr.count;
                    
                    targetPositions[i*3] = targetPosAttr.array[targetIndex*3] * scale; 
                    targetPositions[i*3+1] = targetPosAttr.array[targetIndex*3+1] * scale; 
                    targetPositions[i*3+2] = targetPosAttr.array[targetIndex*3+2] * scale;
                    
                    if(targetColorAttr) {
                        targetColors[i*3] = targetColorAttr.array[targetIndex*3];
                        targetColors[i*3+1] = targetColorAttr.array[targetIndex*3+1];
                        targetColors[i*3+2] = targetColorAttr.array[targetIndex*3+2];
                    }
                    
                    if(targetLifeAttr) {
                        targetLifes[i] = targetLifeAttr.array[targetIndex];
                    }
                }
                
                if (this.mesh.type === 'Points') { 
                    this.geometry.setAttribute('position', new THREE.BufferAttribute(targetPositions, 3)); 
                    this.geometry.setAttribute('color', new THREE.BufferAttribute(targetColors, 3));
                    this.geometry.setAttribute('life', new THREE.BufferAttribute(targetLifes, 1));
                    this.geometry.attributes.position.needsUpdate = true; 
                    this.geometry.attributes.color.needsUpdate = true;
                    this.geometry.attributes.life.needsUpdate = true;
                } else { 
                    this.activeMorph = gsap.to(this.originalPositions, { endArray: targetPositions, duration: 2.0, ease: "power3.inOut" }); 
                }
            }

            setParticleMode(asParticles, activeTheme) {
                const themeMaterial = SACRED_GEOMETRY_LIBRARY[activeTheme]?.material || 'neural';
                const shouldUseParticles = asParticles || themeMaterial === 'nebula';

                // Harmoni-fix: Omstrukturerad och f√∂renklad logik f√∂r att garantera att alla teman kan bli partiklar.
                if (shouldUseParticles) {
                    this.isParticleSystem = true;
                    this.setMaterial('nebula');
                } else {
                    this.isParticleSystem = false;
                    this.setMaterial(themeMaterial);
                }
            }

            setMorph(fromKey, toKey, progress) {
                const fromGeo = this.geometries[fromKey.toLowerCase()];
                const toGeo = this.geometries[toKey.toLowerCase()];
                if (!fromGeo || !toGeo) return;

                const vertexCount = this.originalPositions.length / 3;

                if (this.isParticleSystem) {
                    // Particle system morphing logic
                    if (!this.geometry.attributes.morphTarget) {
                        this.geometry.setAttribute('morphTarget', new THREE.BufferAttribute(new Float32Array(vertexCount * 3), 3));
                    }

                    const startArray = this.geometry.attributes.position.array;
                    const targetArray = this.geometry.attributes.morphTarget.array;
                    const colorArray = this.geometry.attributes.color.array;
                    const fromColors = fromGeo.attributes.color.array;

                    for (let i = 0; i < vertexCount; i++) {
                        const fromIndex = (i % fromGeo.attributes.position.count) * 3;
                        const toIndex = (i % toGeo.attributes.position.count) * 3;
                        
                        startArray[i * 3]     = fromGeo.attributes.position.array[fromIndex];
                        startArray[i * 3 + 1] = fromGeo.attributes.position.array[fromIndex + 1];
                        startArray[i * 3 + 2] = fromGeo.attributes.position.array[fromIndex + 2];

                        targetArray[i * 3]     = toGeo.attributes.position.array[toIndex];
                        targetArray[i * 3 + 1] = toGeo.attributes.position.array[toIndex + 1];
                        targetArray[i * 3 + 2] = toGeo.attributes.position.array[toIndex + 2];

                        const fromColorIndex = (i % fromGeo.attributes.color.count) * 3;
                        colorArray[i * 3]     = fromColors[fromColorIndex];
                        colorArray[i * 3 + 1] = fromColors[fromColorIndex + 1];
                        colorArray[i * 3 + 2] = fromColors[fromColorIndex + 2];
                    }

                    this.geometry.attributes.position.needsUpdate = true;
                    this.geometry.attributes.morphTarget.needsUpdate = true;
                    this.geometry.attributes.color.needsUpdate = true;
                    this.mesh.material.uniforms.morphProgress.value = progress;
                } else {
                    // Solid geometry morphing logic (physics-based)
                    const fromPos = fromGeo.attributes.position.array;
                    const toPos = toGeo.attributes.position.array;
                    
                    for (let i = 0; i < vertexCount; i++) {
                        const fromIndex = (i % fromGeo.attributes.position.count) * 3;
                        const toIndex = (i % toGeo.attributes.position.count) * 3;

                        const x = fromPos[fromIndex] * (1 - progress) + toPos[toIndex] * progress;
                        const y = fromPos[fromIndex + 1] * (1 - progress) + toPos[toIndex + 1] * progress;
                        const z = fromPos[fromIndex + 2] * (1 - progress) + toPos[toIndex + 2] * progress;
                        
                        this.originalPositions[i * 3] = x;
                        this.originalPositions[i * 3 + 1] = y;
                        this.originalPositions[i * 3 + 2] = z;
                    }
                }
            }
        }
    
    // Anti-Fragile Initialization Sequence
        try {
            window.UnifiedGeometryManager = new UnifiedGeometryManager();
            window.UnifiedGeometryManager.init();

            if (!window.UnifiedGeometryManager.initializationFailed) {
                new RitbordetManager().init();
                new GalleryManager().init();
            } else {
                throw new Error("Kritisk visuell komponent (UnifiedGeometryManager) misslyckades att initiera. Faller tillbaka till grundl√§ggande funktionalitet.");
            }
        } catch (error) {
            console.error("Total systemharmoni kunde inte uppn√•s:", error);
            logToExternalService(error, "GlobalInitialization");
        }

        window.nord.closeMobileMenu = () => {
             const mobileMenu = document.getElementById('mobile-menu');
             const mobileMenuTrigger = document.getElementById('mobile-menu-trigger');
             if(mobileMenu && mobileMenuTrigger) {
                mobileMenu.classList.remove('open');
                mobileMenu.style.maxHeight = '0px';
                mobileMenuTrigger.querySelector('i').className = 'ph ph-list text-3xl';
             }
        };
        window.nord.updateActiveLink = function(navId) {
            document.querySelectorAll('header nav a.nav-link, #mobile-menu a').forEach(link => {
                link.classList.remove('active');
                if (link.closest('#mobile-menu')) { link.classList.remove('bg-sky-700/50', 'nord-accent-text', 'font-semibold'); }
            });
            const activeLinks = document.querySelectorAll(`a[data-nav="${navId}"]`);
            activeLinks.forEach(link => {
                link.classList.add('active');
                if (link.closest('#mobile-menu')) { link.classList.add('bg-sky-700/50', 'nord-accent-text', 'font-semibold'); }
            });
        };
        
        const mobileMenuTrigger = document.getElementById('mobile-menu-trigger');
        if (mobileMenuTrigger) {
            mobileMenuTrigger.addEventListener('click', () => {
                const mobileMenu = document.getElementById('mobile-menu');
                const icon = mobileMenuTrigger.querySelector('i');
                mobileMenu.classList.toggle('open');

                if (mobileMenu.classList.contains('open')) {
                    mobileMenu.style.maxHeight = mobileMenu.scrollHeight + "px";
                    icon.className = 'ph ph-x text-3xl';
                } else {
                    mobileMenu.style.maxHeight = '0px';
                    icon.className = 'ph ph-list text-3xl';
                }
            });
        }
        
        function setupCTAInteractions() {
            const ctaSelectors = [ '.btn-cta-revised', '.btn-secondary-on-dark', '.venn-overlap-text', '#hero-logo-wrapper', '.nav-link' ];
            const interactiveElements = document.querySelectorAll(ctaSelectors.join(', '));
            interactiveElements.forEach(el => {
                const nudgeEffect = () => {
                    if (window.UnifiedGeometryManager && window.UnifiedGeometryManager.elasticGeometry && !document.body.classList.contains('labb-active')) {
                        window.UnifiedGeometryManager.elasticGeometry.nudge();
                    }
                };
                el.addEventListener('mouseenter', nudgeEffect);
                el.addEventListener('click', nudgeEffect);
            });
        }

        window.addEventListener('load', () => { const hash = window.location.hash.substring(1); window.nord.showPage(pageConfig[hash] ? hash : 'hero'); });
        
        new FormManager('formSkraddarsydd', 'xqabggao');
        new FormManager('jobApplicationForm', 'xblypplz');

        setupCTAInteractions();
        document.getElementById('currentYear').textContent = new Date().getFullYear();
    });

    class RitbordetManager {
        constructor() {
            this.processCardsData = [
                { icon: 'ph-map-trifold', title: 'KARTL√ÑGGNING', description: 'Vi avkodar era v√§rdefl√∂den och identifierar m√∂jligheter f√∂r intelligent f√∂rst√§rkning.' },
                { icon: 'ph-compass-tool', title: 'ARKITEKTUR', description: 'Vi designar intelligenta system kalibrerade f√∂r era unika processer och aff√§rslogik.' },
                { icon: 'ph-rocket-launch', title: 'AKTIVERING', description: 'Systemet integreras. Era processer f√∂rvandlas till l√§rande intelligens.' }
            ];
            this.valueCardsData = [
                 { type: 'default', icon: 'ph-graph', title: 'TRANSFORMATION', description: 'Intelligenta system som v√§xer med er verksamhet och m√∂jligg√∂r obegr√§nsad skalning.', buttonText: 'L√§s Caset ‚Üí', page: 'atom-gallery-section' },
                 { type: 'default', icon: 'ph-atom', title: 'K√ÑRNKOMPONENTER', description: 'Distribuerad intelligens byggd p√• era aff√§rsregler - system som f√∂rst√•r er branschlogik och utvecklas med den.', buttonText: 'Utforska Arkitekturen', page: 'system', tooltip: 'V√•r motor f√∂r s√∂ml√∂s synkronisering av intelligens.' },
                 { type: 'pricing-preview', title: 'INVESTERING', price: '75k - 500k+', description: 'Fr√•n investering till intelligent evolution. Er framtidsf√∂rs√§kring b√∂rjar h√§r.', buttonText: 'Se Paket ‚Üí', page: 'system' }
            ];
        }

        init() {
            // Harmoni-fix: F√∂renklad och robust logik. Skapa alltid inneh√•llet f√∂r b√•de desktop och mobil.
            // L√•t CSS sk√∂ta synligheten via @media queries. Detta eliminerar komplex och felben√§gen JS-logik.
            this.populateDesktopCards();
            this.renderMobileLayout();
        }

        populateDesktopCards() {
            const topContainer = document.getElementById('ritbordet-grid-top');
            const bottomContainer = document.getElementById('ritbordet-grid-bottom');
            if(!topContainer || !bottomContainer) return;
            
            topContainer.innerHTML = this.processCardsData.map(card => this.createCardHTML(card)).join('');
            bottomContainer.innerHTML = this.valueCardsData.map(card => this.createCardHTML(card)).join('');
        }
        
        createCardHTML(card) {
            const clickHandler = `window.nord.showPage('hero'); setTimeout(() => document.getElementById('${card.page}').scrollIntoView({ behavior: 'smooth' }), 500);`;
            
            const buttonHTML = card.buttonText ? `<button onclick="${card.page === 'atom-gallery-section' ? clickHandler : `window.nord.showPage('${card.page}')`}" class="btn-base btn-secondary-on-dark text-sm">${card.buttonText}</button>` : '';

            if(card.type === 'pricing-preview') {
                return `<div class="ritbordet-card pricing-preview card-base">
                            <i class="ph ph-tag"></i>
                            <h4>${card.title}</h4>
                            <div class="price-range">${card.price}</div>
                            <p>${card.description}</p>
                            ${buttonHTML}
                        </div>`;
            }

            return `<div class="ritbordet-card card-base" ${card.tooltip ? `title="${card.tooltip}"` : ''}>
                        <i class="ph ${card.icon}"></i>
                        <h4>${card.title}</h4>
                        <p>${card.description}</p>
                        ${buttonHTML}
                    </div>`;
        }

        renderMobileLayout() {
            const mobileContent = document.getElementById('mobile-lobby-content');
            if (!mobileContent) return;

            const allCards = [...this.processCardsData, ...this.valueCardsData];
            const mobileHTML = `<div class="ritbordet-grid">${allCards.map(c => this.createCardHTML(c)).join('')}</div>`;
            
            mobileContent.innerHTML = mobileHTML;
        }
    }

    class GalleryManager {
        constructor() {
            this.isInitialMobileLoad = true; // HARMONI-FIX: Flagga f√∂r att f√∂rhindra initial scroll.
            this.galleryData = [
                {
                    icon: 'ph-robot',
                    title: 'AI-Agenter',
                    description: 'Vi designar och drifts√§tter autonoma AI-agenter som hanterar komplexa uppgifter, fr√•n research till kunddialog, med inbyggda loopar f√∂r m√§nsklig validering.',
                    signatures: [
                        { icon: 'ph-brain', text: 'Intelligens' },
                        { icon: 'ph-chats-circle', text: 'Dialog' },
                        { icon: 'ph-file-search', text: 'Research' }
                    ],
                    indicator: 'Bygger p√• 40+ validerade m√∂nster f√∂r AI-orkestrering.'
                },
                {
                    icon: 'ph-lightning',
                    title: 'Processautomation',
                    description: 'Vi transformerar era manuella processer till sj√§lvk√∂rande, intelligenta arbetsfl√∂den som l√§r sig och anpassar sig √∂ver tid, komplett med robust felhantering.',
                    signatures: [
                        { icon: 'ph-arrows-clockwise', text: 'Sj√§lvg√•ende' },
                        { icon: 'ph-timer', text: 'Effektivitet' },
                        { icon: 'ph-shield-check', text: 'Robusthet' }
                    ],
                    indicator: 'Baserad p√• v√•r katalog av 200+ bepr√∂vade automationsmallar.'
                },
                {
                    icon: 'ph-chart-line',
                    title: 'Data & Insikt',
                    description: 'V√•ra system samlar in, analyserar och omvandlar data fr√•n alla era k√§llor till handlingsbara insikter med hj√§lp av avancerad RAG-teknologi.',
                     signatures: [
                        { icon: 'ph-database', text: 'Datak√§llor' },
                        { icon: 'ph-chart-bar', text: 'Analys' },
                        { icon: 'ph-lightbulb', text: 'Insikt' }
                    ],
                    indicator: 'Anv√§nder 15+ bepr√∂vade integrationsm√∂nster f√∂r dataharmonisering.'
                },
                {
                    icon: 'ph-magic-wand',
                    title: 'Inneh√•llsfl√∂den',
                    description: 'Vi automatiserar hela er inneh√•llscykel ‚Äì fr√•n id√© och research till skapande och distribution p√• flera plattformar, optimerat f√∂r maximal r√§ckvidd.',
                    signatures: [
                        { icon: 'ph-pencil-circle', text: 'Skapande' },
                        { icon: 'ph-paper-plane-tilt', text: 'Distribution' },
                        { icon: 'ph-megaphone', text: 'R√§ckvidd' }
                    ],
                    indicator: 'Bygger p√• bepr√∂vade modeller f√∂r automatiserad inneh√•llsdistribution.'
                },
                {
                    icon: 'ph-envelope-simple',
                    title: 'CRM & S√§ljautomation',
                    description: 'Vi revolutionerar er s√§ljprocess med AI-driven personalisering, automatiserad lead-hantering och komplett livscykelautomation direkt i ert CRM.',
                     signatures: [
                        { icon: 'ph-users-three', text: 'Leads' },
                        { icon: 'ph-target', text: 'Personalisering' },
                        { icon: 'ph-chart-line-up', text: 'Konvertering' }
                    ],
                    indicator: 'Optimerar s√§ljfl√∂den med √∂ver 30+ ramverk f√∂r CRM-automation.'
                },
                {
                    icon: 'ph-magnifying-glass',
                    title: 'Automatiserad Research',
                    description: 'S√§tt en arm√© av AI-agenter i arbete f√∂r att leverera djupg√•ende marknads-, konkurrent- och f√∂retagsanalyser p√• en br√•kdel av den manuella tiden.',
                     signatures: [
                        { icon: 'ph-globe-hemisphere-west', text: 'Marknad' },
                        { icon: 'ph-buildings', text: 'F√∂retag' },
                        { icon: 'ph-users', text: 'Konkurrenter' }
                    ],
                    indicator: 'Levererar sammansatt intelligens fr√•n 20+ modeller f√∂r research-automation.'
                },
                {
                    icon: 'ph-film-strip',
                    title: 'Mediaproduktion',
                    description: 'Fr√•n r√•material till f√§rdigt inneh√•ll. Vi bygger AI-drivna fl√∂den som automatiserar produktion och distribution av video, ljud och bild f√∂r alla era kanaler.',
                    signatures: [
                        { icon: 'ph-video-camera', text: 'Video' },
                        { icon: 'ph-microphone-stage', text: 'Ljud' },
                        { icon: 'ph-image', text: 'Bild' }
                    ],
                    indicator: 'Hanterar hela mediaproduktionen med 18+ bepr√∂vade systemfl√∂den.'
                },
                {
                    icon: 'ph-plugs-connected',
                    title: 'FlowNode',
                    description: 'V√•r egenutvecklade k√§rnteknologi som binder samman alla era system, API:er och AI-modeller till ett s√∂ml√∂st, intelligent n√§tverk. Hj√§rnan i ert ekosystem.',
                    indicator: 'M√∂jligg√∂r portabilitet och framtidss√§krar er tekniska arkitektur.',
                    ctaText: 'Utforska Demo',
                    ctaIcon: 'ph-play-circle',
                    ctaLink: '#' 
                },
                {
                    teaser: true,
                    icon: 'ph-lock-simple',
                    title: 'N√§sta Generations AI-K√§rna',
                    description: 'En ny niv√• av autonomi och proaktiv intelligens, designad f√∂r att f√∂rutse och agera p√• framtida behov.',
                    indicator: 'Lansering Q4 2025'
                },
                {
                    teaser: true,
                    icon: 'ph-puzzle-piece',
                    title: 'Adaptiva Gr√§nssnitt',
                    description: 'Revolutionerande UI som anpassar sig i realtid efter anv√§ndarens unika kontext, m√•l och arbetsfl√∂de.',
                    indicator: 'Lansering Q1 2026'
                }
            ];
        }
        init() {
            this.populateGallery();
            this.setupGalleryControls();
        }
        populateGallery() {
            const wrapper = document.getElementById('galleryWrapper');
            if (!wrapper) return;
            wrapper.innerHTML = this.galleryData.map(cardData => this.createCardHTML(cardData)).join('');
        }
        createCardHTML(data) {
             const isTeaser = data.teaser || false;
             const cardClasses = `archetype-card card-base ${isTeaser ? 'teaser' : ''}`;

             const ctaButton = data.ctaText ?
                `<a href="${data.ctaLink || '#'}" target="_blank" rel="noopener noreferrer" class="archetype-cta btn-base">
                    <i class="ph ${data.ctaIcon}"></i>
                    <span>${data.ctaText}</span>
                </a>` : '';
            
            const signaturesHTML = data.signatures ? `
                <div class="tech-signature-container">
                    ${data.signatures.map(sig => `
                        <div class="tech-signature-item">
                            <i class="ph ${sig.icon}"></i>
                            <span>${sig.text}</span>
                        </div>
                    `).join('')}
                </div>
            ` : '';

             return `
                <div class="${cardClasses}">
                    <i class="ph ${data.icon}"></i>
                    <h4>${data.title}</h4>
                    <p class="description">${data.description}</p>
                    ${signaturesHTML}
                    ${ctaButton}
                    <p class="indicator">${data.indicator}</p>
                </div>
            `;
        }
        setupGalleryControls() {
            const galleryWrapper = document.getElementById('galleryWrapper'), nextBtn = document.getElementById('galleryNext'), prevBtn = document.getElementById('galleryPrev');
            if (!galleryWrapper || !nextBtn || !prevBtn) return;
            let currentIndex = 0;
            const getCardsPerPage = () => {
                if (window.innerWidth > 1024) return 3;
                if (window.innerWidth > 768) return 2;
                return 1;
            };
            const totalCards = this.galleryData.length;
            const updateGallery = () => {
                const cardsPerPage = getCardsPerPage();
                const maxIndex = totalCards - cardsPerPage;
                if (currentIndex > maxIndex) currentIndex = maxIndex;
                
                const cardWidth = galleryWrapper.children[0].offsetWidth;
                const gap = 32; // Corresponds to gap-8 (2rem)
                const totalMove = (cardWidth + gap) * currentIndex;

                if (window.innerWidth > 768) {
                    galleryWrapper.style.transform = `translateX(-${totalMove}px)`;
                } else {
                    if (!this.isInitialMobileLoad) {
                        const card = galleryWrapper.children[currentIndex];
                        if(card) card.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'start' });
                    }
                    this.isInitialMobileLoad = false;
                }
                prevBtn.classList.toggle('disabled', currentIndex === 0);
                nextBtn.classList.toggle('disabled', currentIndex >= maxIndex);
            };
            nextBtn.addEventListener('click', () => { 
                const cardsPerPage = getCardsPerPage();
                if (currentIndex < totalCards - cardsPerPage) { 
                    currentIndex++; 
                    updateGallery(); 
                } 
            });
            prevBtn.addEventListener('click', () => { 
                if (currentIndex > 0) { 
                    currentIndex--; 
                    updateGallery(); 
                } 
            });
            window.addEventListener('resize', updateGallery);
            updateGallery();
        }
    }

    class FormManager {
        constructor(formId, formspreeId) {
            this.formId = formId;
            this.formspreeId = formspreeId;
            this.formElement = document.getElementById(this.formId);
            if (!this.formElement) return;

            this.container = this.formElement.closest('.form-container');
            this.steps = this.formElement.querySelectorAll('.form-step');
            this.progressBar = this.container.querySelector('.form-progress-bar-inner');
            this.currentStep = 0;
            this.totalSteps = this.steps.length;

            this.init();
        }

        init() {
            this.setupEventListeners();
            this.updateProgress();
            this.steps[0].classList.add('active');
        }

        setupEventListeners() {
            this.formElement.addEventListener('submit', this.handleSubmit.bind(this));
            
            this.formElement.querySelectorAll('.form-navigation button').forEach(button => {
                button.addEventListener('click', (e) => {
                    if (e.currentTarget.type === 'button') {
                        const isNext = e.currentTarget.textContent.includes('N√§sta');
                        if (isNext) this.nextStep();
                        else this.prevStep();
                    }
                });
            });
        }

        changeStep(stepIndex) {
            const currentStepElement = this.steps[this.currentStep];
            const nextStepElement = this.steps[stepIndex];

            gsap.to(currentStepElement, {
                opacity: 0, 
                y: -10, 
                duration: 0.3, 
                ease: 'power2.in', 
                onComplete: () => {
                    currentStepElement.classList.remove('active');
                    nextStepElement.classList.add('active');
                    this.currentStep = stepIndex;
                    this.updateProgress();
                    gsap.fromTo(nextStepElement, 
                        { opacity: 0, y: 10 }, 
                        { opacity: 1, y: 0, duration: 0.3, ease: 'power2.out' }
                    );
                }
            });
        }

        validateStep() {
            const currentStepElement = this.steps[this.currentStep];
            const inputs = currentStepElement.querySelectorAll('input[required], textarea[required]');
            for (const input of inputs) {
                if (!input.value.trim()) {
                    input.focus();
                    gsap.fromTo(input, { x: -5 }, { x: 5, duration: 0.05, repeat: 5, yoyo: true, clearProps: 'x' });
                    return false;
                }
            }
            return true;
        }

        nextStep() {
            if (this.validateStep() && this.currentStep < this.totalSteps - 1) {
                this.changeStep(this.currentStep + 1);
            }
        }

        prevStep() {
            if (this.currentStep > 0) {
                this.changeStep(this.currentStep + 1);
            }
        }

        updateProgress() {
            const progress = ((this.currentStep + 1) / this.totalSteps) * 100;
            if (this.progressBar) {
                this.progressBar.style.width = `${progress}%`;
            }
        }

        handleSubmit(e) {
            e.preventDefault();
            if (!this.validateStep()) return;

            this.container.classList.add('form-loading');
            
            fetch(`https://formspree.io/f/${this.formspreeId}`, {
                method: 'POST',
                body: new FormData(this.formElement),
                headers: { 'Accept': 'application/json' }
            }).then(response => {
                this.container.classList.remove('form-loading');
                if (response.ok) {
                    this.showSuccess();
                } else {
                    throw new Error('Form submission failed');
                }
            }).catch(() => {
                this.container.classList.remove('form-loading');
                this.showError();
            });
        }

        showSuccess() {
            const successHTML = `
                <div class="form-success-container">
                    <i class="ph-star-four nordsym-logo-star"></i>
                    <p>Tack! Ditt meddelande har skickats. Vi √•terkommer snart.</p>
                </div>`;
            
            gsap.to(this.container.children, {
                opacity: 0,
                duration: 0.5,
                ease: 'power2.in',
                onComplete: () => {
                    this.container.innerHTML = successHTML;
                    gsap.fromTo(this.container.children, 
                        { opacity: 0, scale: 0.9 },
                        { opacity: 1, scale: 1, duration: 0.5, ease: 'power2.out' }
                    );
                }
            });
        }

        showError() {
            const errorHTML = `<div class="form-message form-error-message" style="display:block;">Ett fel uppstod. F√∂rs√∂k igen eller kontakta oss direkt.</div>`;
            this.formElement.innerHTML = errorHTML;
        }
    }
    </script>
</body>
</html>































































